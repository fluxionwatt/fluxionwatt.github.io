import{_ as a,c as s,o as n,ah as e,gY as i,gZ as d,g_ as o,g$ as l,h0 as p}from"./chunks/framework.BDBjiFeZ.js";const T=JSON.parse('{"title":"固件升级（OTA）","description":"","frontmatter":{"sidebar_position":2},"headers":[],"relativePath":"zh_CN/user-guide/tenant-operation-manual/product-management/ota.md","filePath":"zh_CN/user-guide/tenant-operation-manual/product-management/ota.md"}'),r={name:"zh_CN/user-guide/tenant-operation-manual/product-management/ota.md"};function u(c,t,h,g,q,b){return n(),s("div",null,[...t[0]||(t[0]=[e('<h1 id="固件升级-ota" tabindex="-1">固件升级（OTA） <a class="header-anchor" href="#固件升级-ota" aria-label="Permalink to “固件升级（OTA）”">​</a></h1><p>OTA全称&quot;Over-The-Airtechnology&quot;，即空中下载技术，通过移动通信的接口实现对软件进行远程管理，简单来说就是对固件的远程升级。</p><h2 id="功能说明" tabindex="-1">功能说明 <a class="header-anchor" href="#功能说明" aria-label="Permalink to “功能说明”">​</a></h2><ul><li>升级包管理：给不同的产品的不同的版本添加升级包</li><li>任务管理：创建升级任务，可设定升级时间（立即或定时），选择升级的设备（全部或者部分）</li><li>升级报表：查看待推送、已推送、升级中、升级成功、升级失败、已取消的统计。查看升级进度，对失败的可重新升级。</li></ul><h2 id="ota升级流程" tabindex="-1">OTA升级流程 <a class="header-anchor" href="#ota升级流程" aria-label="Permalink to “OTA升级流程”">​</a></h2><p>MQTT协议下OTA升级流程如下图所示。 <img src="'+i+`" alt="OTA升级流程"></p><h2 id="ota升级说明" tabindex="-1">OTA升级说明 <a class="header-anchor" href="#ota升级说明" aria-label="Permalink to “OTA升级说明”">​</a></h2><ul><li>若设备需要在首次升级前上报版本号，建议只在系统启动过程中上报一次，不需要周期循环上报。设备升级成功后，需要第一时间上报版本。</li><li>设备端接收到物联网平台推送的升级通知后，可立即下载升级包进行升级，也可在业务空闲后，主动获取升级信息进行升级。</li><li>物联网平台根据设备端上报的进度是否是100%来判断设备端OTA升级是否成功。</li><li>升级中的设备，当设备主题推送版本与升级的版本不一致的时候，推送最新的版本信息给设备，默认推送3次，第四次按升级失败算（可重新升级）</li><li>支持断点续传，具体查看接口文档</li></ul><h2 id="数据格式说明" tabindex="-1">数据格式说明 <a class="header-anchor" href="#数据格式说明" aria-label="Permalink to “数据格式说明”">​</a></h2><p>OTA升级流程及使用的Topic和数据格式如下：</p><ol><li>（可选）设备连接OTA服务，上报版本号。<br> 设备端通过MQTT协议推送当前设备OTA模块版本号到Topic： ota/device/inform。消息格式如下：<div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>{</span></span>
<span class="line"><span>    &quot;id&quot;: &quot;147258369&quot;,</span></span>
<span class="line"><span>    &quot;params&quot;: {</span></span>
<span class="line"><span>        &quot;version&quot;: &quot;v1.0.1&quot;,</span></span>
<span class="line"><span>        &quot;module&quot;: &quot;default&quot;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><table tabindex="0"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>String</td><td>消息ID号。String类型的数字，长度10，且每个消息ID在当前设备中具有唯一性。</td></tr><tr><td>version</td><td>String</td><td>OTA模块版本。</td></tr><tr><td>module</td><td>String</td><td>OTA模块名。设备的默认（default）模块的版本号代表整个设备的固件版本号。</td></tr></tbody></table></li><li>您在控制台触发升级操作之后，设备会收到物联网平台OTA服务推送的升级包的URL地址。 设备端订阅Topic：ota/device/inform/\${AccessToken}。物联网平台对设备发起OTA升级请求后，设备端会通过该Topic收到升级包的存储地址URL。 消息格式如下：<div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>{</span></span>
<span class="line"><span>    &quot;id&quot;:&quot;147258369&quot;,</span></span>
<span class="line"><span>    &quot;code&quot;: 200,</span></span>
<span class="line"><span>    &quot;params&quot;:{</span></span>
<span class="line"><span>        &quot;version&quot;:&quot;v1.1&quot;,</span></span>
<span class="line"><span>        &quot;size&quot;:432945,</span></span>
<span class="line"><span>        &quot;url&quot;:&quot;http://dev.thingspane.cn/files/ota/s121jg3245gg.zip&quot;,</span></span>
<span class="line"><span>        &quot;signMethod&quot;:&quot;Md5&quot;,</span></span>
<span class="line"><span>        &quot;sign&quot;:&quot;a243fgh4b9v&quot;,</span></span>
<span class="line"><span>        &quot;module&quot;:&quot;MCU&quot;,</span></span>
<span class="line"><span>        &quot;extData&quot;:{</span></span>
<span class="line"><span>                &quot;key1&quot;:&quot;value1&quot;,</span></span>
<span class="line"><span>                &quot;key2&quot;:&quot;value2&quot;</span></span>
<span class="line"><span>         }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><table tabindex="0"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>Long</td><td>消息ID号。每个消息ID在当前设备中具有唯一性。</td></tr><tr><td>code</td><td>String</td><td>状态码。</td></tr><tr><td>version</td><td>String</td><td>设备升级包的版本信息。</td></tr><tr><td>size</td><td>Long</td><td>升级包文件大小，单位：字节。 OTA升级包中仅有一个升级包文件时，包含该参数。</td></tr><tr><td>url</td><td>String</td><td>升级包在对象存储（OSS）上的存储地址。 OTA升级包中仅有一个升级包文件，且下载协议为HTTPS时，包含该参数。</td></tr><tr><td>sign</td><td>String</td><td>OTA升级包文件的签名。 OTA升级包中仅有一个升级包文件时，包含该参数。</td></tr><tr><td>signMethod</td><td>String</td><td>签名方法。取值：SHA256、MD5。对于Android差分升级包类型，仅支持MD5签名方法。</td></tr><tr><td>module</td><td>String</td><td>升级包所属的模块名。模块名为default时，物联网平台不下发module参数。</td></tr><tr><td>extData</td><td>Object</td><td>升级批次标签列表和推送给设备的自定义信息。_package_udi表示自定义信息的字段。单个标签格式：&quot;key&quot;:&quot;value&quot;。</td></tr></tbody></table></li><li>升级过程中，设备端向服务端推送升级进度到Topic：ota/device/progress。 消息格式如下：<div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>{</span></span>
<span class="line"><span>    &quot;step&quot;:&quot;100&quot;,</span></span>
<span class="line"><span>    &quot;desc&quot;:&quot;升级进度100%&quot;,</span></span>
<span class="line"><span>    &quot;module&quot;: &quot;MCU&quot;</span></span>
<span class="line"><span>}</span></span></code></pre></div><table tabindex="0"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>step</td><td>String</td><td>OTA升级进度。取值范围：1~100的整数字符串：升级进度百分比。-1：升级失败。-2：下载失败。-3：校验失败。-4：烧写失败。</td></tr><tr><td>desc</td><td>String</td><td>当前步骤的描述信息，长度不超过128个字符。如果发生异常，此字段可承载错误信息。</td></tr><tr><td>module</td><td>String</td><td>升级包所属的模块名。可选</td></tr></tbody></table></li></ol><h2 id="操作步骤" tabindex="-1">操作步骤 <a class="header-anchor" href="#操作步骤" aria-label="Permalink to “操作步骤”">​</a></h2><ol><li><code>产品管理</code>-&gt;<code>固件升级</code>-&gt;<code>添加升级包</code>，如下表单。 <img src="`+d+'" alt="添加升级包"></li><li>点击<code>查看</code>按钮进入升级任务列表页面 <img src="'+o+'" alt="固件升级-查看"></li><li>点击<code>添加升级任务</code>按钮，填写表单。 <img src="'+l+'" alt="添加升级任务"></li><li>点击<code>查看</code>按钮，进入设备升级详情页面，可以在这里查看设备升级进度；对于升级失败的设备可进行重新升级操作，也可进行取消升级操作 <img src="'+p+'" alt="升级详情"></li></ol>',13)])])}const k=a(r,[["render",u]]);export{T as __pageData,k as default};
