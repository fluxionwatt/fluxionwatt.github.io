import{_ as i,c as a,o as n,ah as l,d$ as t}from"./chunks/framework.BDBjiFeZ.js";const g=JSON.parse('{"title":"设备接入服务开发指南","description":"","frontmatter":{"sidebar_position":4},"headers":[],"relativePath":"zh_CN/developer-guide/developing-plug-in/customProtocol.md","filePath":"zh_CN/developer-guide/developing-plug-in/customProtocol.md"}'),e={name:"zh_CN/developer-guide/developing-plug-in/customProtocol.md"};function h(r,s,p,k,d,E){return n(),a("div",null,[...s[0]||(s[0]=[l('<h1 id="设备接入服务开发指南" tabindex="-1">设备接入服务开发指南 <a class="header-anchor" href="#设备接入服务开发指南" aria-label="Permalink to “设备接入服务开发指南”">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to “概述”">​</a></h2><h3 id="背景与问题" tabindex="-1">背景与问题 <a class="header-anchor" href="#背景与问题" aria-label="Permalink to “背景与问题”">​</a></h3><p>在物联网领域，通信协议极为多样且复杂。常见的协议包括MQTT、TCP、HTTP、SOAP、Modbus、OPC-UA、Bacnet、KNX、LwM2M和SNMP等，还有数不清的其他协议以及各种各样的网关服务或三方服务。</p><div class="warning custom-block"><p class="custom-block-title">现状与挑战</p><ul><li><strong>复杂性</strong>：这些协议和服务在通信模式和报文规范上各不相同，导致在系统集成时面临巨大的复杂性</li><li><strong>后果</strong>：这种复杂性不仅使系统变得臃肿、效率低下，而且还难以扩展和维护，进而导致维护成本居高不下</li></ul></div><h3 id="服务定义" tabindex="-1">服务定义 <a class="header-anchor" href="#服务定义" aria-label="Permalink to “服务定义”">​</a></h3><p>设备接入服务是一个多功能中间件组件，作为设备与系统之间的桥梁，将设备接入ThingsPanel平台，实现设备与平台的交互。</p><h3 id="服务类别" tabindex="-1">服务类别 <a class="header-anchor" href="#服务类别" aria-label="Permalink to “服务类别”">​</a></h3><div class="info custom-block"><p class="custom-block-title">两大核心类别</p><ol><li><strong>设备接入服务</strong>：支持各种物联网协议（如MODBUS、MQTT等），使ThingsPanel平台能够<strong>直接</strong>与使用这些协议的设备通信</li><li><strong>三方设备接入服务</strong>：连接ThingsPanel平台与各种第三方物联网平台，<strong>间接</strong>与设备通信，实现数据互通和设备管理</li></ol></div><h3 id="主要功能" tabindex="-1">主要功能 <a class="header-anchor" href="#主要功能" aria-label="Permalink to “主要功能”">​</a></h3><ul><li>🔗 提供统一的接口规范，简化设备和第三方平台的接入流程</li><li>🌐 支持多种协议和服务，增强ThingsPanel平台的兼容性和扩展性</li><li>⚙️ 实现灵活的配置和凭证管理，方便用户快速接入不同的协议和第三方平台</li><li>📊 实时数据同步和设备状态监控</li><li>🔧 模块化设计，易于扩展支持新的协议和第三方平台</li></ul><h3 id="交互结构图" tabindex="-1">交互结构图 <a class="header-anchor" href="#交互结构图" aria-label="Permalink to “交互结构图”">​</a></h3><p><img src="'+t+`" alt=""></p><h3 id="架构图" tabindex="-1">架构图 <a class="header-anchor" href="#架构图" aria-label="Permalink to “架构图”">​</a></h3><div class="language-mermaid"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph &quot;设备层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        D1[直连设备]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        D2[网关设备]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        D3[子设备]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TP[第三方平台]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph &quot;服务层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        CP[设备接入服务]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SP[三方设备接入服务]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph &quot;平台层&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        MQTT[MQTT Broker]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        API[平台API]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TP_CORE[ThingsPanel核心]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    D1 --&gt; CP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    D2 --&gt; CP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    D3 --&gt; CP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TP --&gt; SP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CP --&gt; MQTT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SP --&gt; MQTT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    MQTT --&gt; TP_CORE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CP &lt;--&gt; API</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SP &lt;--&gt; API</span></span></code></pre></div><h2 id="设备接入服务交互流程" tabindex="-1">设备接入服务交互流程 <a class="header-anchor" href="#设备接入服务交互流程" aria-label="Permalink to “设备接入服务交互流程”">​</a></h2><div class="language-mermaid"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant 用户</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant OurPlatform as 物联网平台</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant Plugin as 三方设备接入服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant ThirdParty as 第三方平台</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Plugin-&gt;&gt;OurPlatform: 注册服务（或管理员注册）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    用户-&gt;&gt;OurPlatform: 创建该服务的设备配置模板</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    用户-&gt;&gt;OurPlatform: 点击页面选择服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    用户-&gt;&gt;OurPlatform: 输入服务的凭证(认证信息)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    OurPlatform-&gt;&gt;Plugin: 根据凭证获取设备列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Plugin-&gt;&gt;ThirdParty: 获取设备列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ThirdParty-&gt;&gt;Plugin: 返回设备列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Plugin-&gt;&gt;OurPlatform: 显示设备列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    用户-&gt;&gt;OurPlatform: 选择需要的设备、绑定配置模板</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    OurPlatform-&gt;&gt;OurPlatform: 存储凭证、创建设备</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    OurPlatform-&gt;&gt;Plugin: 通知新增了服务接入（带凭证）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Plugin-&gt;&gt;ThirdParty: 根据凭证与三方平台建立连接</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    loop 设备数据交互</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ThirdParty-&gt;&gt;Plugin: 三方平台设备数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Plugin-&gt;&gt;OurPlatform: 上报设备数据（MQTT）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        OurPlatform-&gt;&gt;Plugin: 下发控制（MQTT）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Plugin-&gt;&gt;ThirdParty: 转发到三方</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span></code></pre></div><h2 id="开发指南" tabindex="-1">开发指南 <a class="header-anchor" href="#开发指南" aria-label="Permalink to “开发指南”">​</a></h2><h3 id="准备工作" tabindex="-1">准备工作 <a class="header-anchor" href="#准备工作" aria-label="Permalink to “准备工作”">​</a></h3><div class="language-mermaid"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mindmap</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  root((设备接入服务开发))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    1、准备工作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      开发环境搭建</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      获取测试账号</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      下载模板代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    2、协议理解</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      数据格式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      通信流程</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      命令结构</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    3、代码实现</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      认证逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      数据解析</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      数据转发</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      命令处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    4、表单开发</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      设备凭证表单</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      服务凭证表单</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      配置表单</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    5、测试与部署</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      本地调试</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      环境部署</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      功能测试</span></span></code></pre></div><h3 id="开发步骤" tabindex="-1">开发步骤 <a class="header-anchor" href="#开发步骤" aria-label="Permalink to “开发步骤”">​</a></h3><h4 id="_1-下载设备接入服务模板" tabindex="-1">1. 下载设备接入服务模板 <a class="header-anchor" href="#_1-下载设备接入服务模板" aria-label="Permalink to “1. 下载设备接入服务模板”">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://gitee.com/ThingsPanel/protocol-plugin-template.git</span></span></code></pre></div><h4 id="_2-理解核心概念" tabindex="-1">2. 理解核心概念 <a class="header-anchor" href="#_2-理解核心概念" aria-label="Permalink to “2. 理解核心概念”">​</a></h4><div class="info custom-block"><p class="custom-block-title">四大核心数据类型</p><p>理解ThingsPanel的四种数据模型对于设备接入服务开发至关重要：</p><ul><li><strong>🔄 遥测（Telemetry）</strong> - 设备实时上报的数据，通常是随时间变化的测量值</li><li><strong>📋 属性（Attributes）</strong> - 设备的静态或较少变化的特征信息</li><li><strong>🎯 事件（Events）</strong> - 设备中发生的特定事件或状态变化</li><li><strong>⚡ 命令（Commands）</strong> - 平台发送到设备的控制指令</li></ul></div><h4 id="_3-修改模板代码" tabindex="-1">3. 修改模板代码 <a class="header-anchor" href="#_3-修改模板代码" aria-label="Permalink to “3. 修改模板代码”">​</a></h4><ul><li>阅读模板源码的README-DEV.md</li><li>更新SDK到最新版本：<div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> github.com/ThingsPanel/tp-protocol-sdk-go@latest</span></span></code></pre></div></li><li>根据协议文档修改凭证表单 <code>from_voucher.json</code></li><li>判断是否需要配置表单</li><li>修改 <code>http_service/service.go</code> 中的接口实现</li></ul><h4 id="_4-注册设备接入服务" tabindex="-1">4. 注册设备接入服务 <a class="header-anchor" href="#_4-注册设备接入服务" aria-label="Permalink to “4. 注册设备接入服务”">​</a></h4><p>使用超管账户在平台注册设备接入服务：</p><ul><li><strong>应用管理</strong> → <strong>设备接入服务管理</strong> → <strong>添加新服务</strong></li></ul><h4 id="_5-编写核心流程" tabindex="-1">5. 编写核心流程 <a class="header-anchor" href="#_5-编写核心流程" aria-label="Permalink to “5. 编写核心流程”">​</a></h4><ul><li>处理设备消息的上下行报文</li><li>使用AI工具辅助生成协议解析代码</li><li>通过MQTT客户端与平台交互数据</li></ul><h4 id="_6-集成测试" tabindex="-1">6. 集成测试 <a class="header-anchor" href="#_6-集成测试" aria-label="Permalink to “6. 集成测试”">​</a></h4><ul><li>创建设备模板并选择协议</li><li>创建设备并绑定模板</li><li>填写设备凭证信息</li><li>连接设备到设备接入服务进行测试</li></ul><h2 id="技术规范" tabindex="-1">技术规范 <a class="header-anchor" href="#技术规范" aria-label="Permalink to “技术规范”">​</a></h2><p>参考接口文档：<a href="https://docs.thingspanel.io/zh/developer-guide/api-reference/index.html" target="_blank" rel="noreferrer">ThingsPanel API文档</a></p><p>目录：</p><ul><li>✨设备接入服务-平台提供</li><li>✨设备接入服务-服务提供</li></ul><h2 id="数据交互规范" tabindex="-1">数据交互规范 <a class="header-anchor" href="#数据交互规范" aria-label="Permalink to “数据交互规范”">​</a></h2><h3 id="设备接入服务推送数据到平台" tabindex="-1">设备接入服务推送数据到平台 <a class="header-anchor" href="#设备接入服务推送数据到平台" aria-label="Permalink to “设备接入服务推送数据到平台”">​</a></h3><h4 id="直连设备-子设备消息-网关设备消息" tabindex="-1">直连设备/子设备消息/网关设备消息 <a class="header-anchor" href="#直连设备-子设备消息-网关设备消息" aria-label="Permalink to “直连设备/子设备消息/网关设备消息”">​</a></h4><ul><li><strong>MQTT用户</strong>：plugin</li><li><strong>发布主题</strong>：<code>device/telemetry</code></li><li><strong>报文格式</strong>：<div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;device_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;device_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;values&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span></code></pre></div></li></ul><h4 id="在线离线通知" tabindex="-1">在线离线通知 <a class="header-anchor" href="#在线离线通知" aria-label="Permalink to “在线离线通知”">​</a></h4><ul><li><strong>发布主题</strong>：<code>device/status</code></li><li><strong>报文格式</strong>：<div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;device_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;device_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;values&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>其中：0-离线，1-上线</li></ul><h3 id="平台推送数据给设备接入服务" tabindex="-1">平台推送数据给设备接入服务 <a class="header-anchor" href="#平台推送数据给设备接入服务" aria-label="Permalink to “平台推送数据给设备接入服务”">​</a></h3><h4 id="订阅主题规范" tabindex="-1">订阅主题规范 <a class="header-anchor" href="#订阅主题规范" aria-label="Permalink to “订阅主题规范”">​</a></h4><p>设备接入服务需要订阅带有前缀的主题：</p><ul><li><strong>订阅主题</strong>：<code>plugin/{service_identifier}/#</code></li><li><strong>主题说明</strong>：<code>plugin/{service_identifier}/</code> 为注册设备接入服务时填写的订阅主题前缀，<code>#</code>部分遵循<a href="./../../device-connect/mqtt-device-rule.html">MQTT设备接入规范</a></li></ul><p>:::note 主题映射 设备接入服务的订阅主题比平台下行规范多了主题前缀，其中<code>device_number</code>需要改为<code>device_id</code> :::</p><h2 id="设备接入服务注册" tabindex="-1">设备接入服务注册 <a class="header-anchor" href="#设备接入服务注册" aria-label="Permalink to “设备接入服务注册”">​</a></h2><h3 id="注册参数" tabindex="-1">注册参数 <a class="header-anchor" href="#注册参数" aria-label="Permalink to “注册参数”">​</a></h3><table tabindex="0"><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>服务名称</td><td>创建设备模板时，会显示在选择协议下拉框中</td></tr><tr><td>服务标识符</td><td>系统中唯一标识这个设备接入服务，由字母和数字组成</td></tr><tr><td>类别</td><td>选择接入协议</td></tr><tr><td>HTTP服务地址</td><td>填写平台后端能够直接访问设备接入服务API的地址，格式如127.0.0.1:8151</td></tr><tr><td>服务订阅主题前缀</td><td>格式如<code>service/{name}/</code></td></tr><tr><td>设备接入地址</td><td>显示在设备凭证管理的下发，提示用户设备连接地址</td></tr></tbody></table><h3 id="注册方式" tabindex="-1">注册方式 <a class="header-anchor" href="#注册方式" aria-label="Permalink to “注册方式”">​</a></h3><h4 id="平台注册" tabindex="-1">平台注册 <a class="header-anchor" href="#平台注册" aria-label="Permalink to “平台注册”">​</a></h4><ol><li>使用超管账号登录</li><li>进入 <strong>应用管理</strong> → <strong>设备接入服务管理</strong></li><li>点击 <strong>添加新服务</strong> 按钮</li><li>填写相关配置信息</li></ol><h2 id="参考资源" tabindex="-1">参考资源 <a class="header-anchor" href="#参考资源" aria-label="Permalink to “参考资源”">​</a></h2><div class="tip custom-block"><p class="custom-block-title">开发资源</p><ul><li><a href="./../../device-connect/mqtt-gateway-rule.html">MQTT网关设备接入规范</a></li><li><a href="./../../device-connect/mqtt-device-rule.html">MQTT直连设备接入规范</a></li><li><a href="https://github.com/ThingsPanel/modbus-protocol-plugin" target="_blank" rel="noreferrer">Modbus设备接入服务示例</a></li><li><a href="https://gitee.com/ThingsPanel/protocol-plugin-pressure-transmitter" target="_blank" rel="noreferrer">GB26875.3-2011设备接入服务示例</a></li></ul></div><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to “最佳实践”">​</a></h2><div class="warning custom-block"><p class="custom-block-title">开发注意事项</p><ol><li><strong>消息ID管理</strong>：建议使用时间戳后7位，确保短期内不重复</li><li><strong>设备唯一性</strong>：确保设备编号在系统中全局唯一</li><li><strong>错误处理</strong>：实现完整的错误响应机制，便于问题诊断</li><li><strong>性能优化</strong>：推荐在设备接入服务内解析数据，避免使用脚本转换</li><li><strong>表单验证</strong>：上报前验证JSON格式的正确性</li><li><strong>设备状态管理</strong>：实现设备状态管理，包括在线、离线。</li></ol></div>`,59)])])}const c=i(e,[["render",h]]);export{g as __pageData,c as default};
