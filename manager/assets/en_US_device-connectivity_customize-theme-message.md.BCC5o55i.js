import{_ as e,c as a,o as t,ah as o,aX as s,aY as n,aZ as l,a_ as r}from"./chunks/framework.BDBjiFeZ.js";const k=JSON.parse('{"title":"Custom Topic & Message","description":"","frontmatter":{"sidebar_position":12},"headers":[],"relativePath":"en_US/device-connectivity/customize-theme-message.md","filePath":"en_US/device-connectivity/customize-theme-message.md"}'),c={name:"en_US/device-connectivity/customize-theme-message.md"};function d(p,i,g,h,u,m){return t(),a("div",null,[...i[0]||(i[0]=[o(`<h1 id="custom-topic-message" tabindex="-1">Custom Topic &amp; Message <a class="header-anchor" href="#custom-topic-message" aria-label="Permalink to “Custom Topic &amp; Message”">​</a></h1><h2 id="i-overview" tabindex="-1">I. Overview <a class="header-anchor" href="#i-overview" aria-label="Permalink to “I. Overview”">​</a></h2><p>Topic transformation is used to map device custom MQTT topics to platform standard topics, enabling non-intrusive access for devices from different vendors.</p><p><strong>Core Concepts:</strong></p><ul><li><strong>Original Topic</strong>: The actual topic published/subscribed by the device.</li><li><strong>Target Topic</strong>: The platform&#39;s standardized topic.</li><li><strong>Data Direction</strong>: <ul><li><strong>Uplink</strong>: Device → Platform</li><li><strong>Downlink</strong>: Platform → Device</li></ul></li></ul><p><strong>Function Combination:</strong> Topic transformation can be combined with <strong>Data Processing</strong> functions to perform format conversion and field mapping on uplink/downlink messages, solving access issues for devices with non-standard messages.</p><hr><h2 id="ii-uplink-topic-transformation" tabindex="-1">II. Uplink Topic Transformation <a class="header-anchor" href="#ii-uplink-topic-transformation" aria-label="Permalink to “II. Uplink Topic Transformation”">​</a></h2><h3 id="definition" tabindex="-1">Definition <a class="header-anchor" href="#definition" aria-label="Permalink to “Definition”">​</a></h3><p>The actual MQTT topic published by the device. Supports using <code>+</code> as a path placeholder to match variable parts. Does not support <code>#</code>. Optional variables can be used to distinguish messages.</p><h3 id="basic-example" tabindex="-1">Basic Example <a class="header-anchor" href="#basic-example" aria-label="Permalink to “Basic Example”">​</a></h3><p><strong>Device Publishes:</strong> <code>123456789/up/devices</code></p><p><strong>Mapping Configuration:</strong></p><ul><li>Original Topic: <code>+/up/devices</code></li><li>Target Topic: <code>devices/telemetry</code></li></ul><p><strong>Result:</strong> Messages published by the device to <code>123456789/up/devices</code> will be automatically forwarded to the platform standard topic <code>devices/telemetry</code>.</p><h3 id="about-message-id" tabindex="-1">About message_id <a class="header-anchor" href="#about-message-id" aria-label="Permalink to “About message_id”">​</a></h3><ul><li><strong>Auto Generation</strong>: If the target topic is configured as <code>devices/attributes/{message_id}</code>, the device does not need to carry <code>message_id</code> when publishing; the system will generate it automatically.</li><li><strong>Response Tracking</strong>: The response topic will carry <code>message_id</code> for the device to identify the corresponding response content.</li></ul><hr><h2 id="iii-downlink-topic-transformation" tabindex="-1">III. Downlink Topic Transformation <a class="header-anchor" href="#iii-downlink-topic-transformation" aria-label="Permalink to “III. Downlink Topic Transformation”">​</a></h2><h3 id="definition-1" tabindex="-1">Definition <a class="header-anchor" href="#definition-1" aria-label="Permalink to “Definition”">​</a></h3><p>The actual MQTT topic subscribed by the device. Supports dynamic variables. The target topic can end with <code>+</code> to match <code>message_id</code>.</p><h3 id="basic-example-1" tabindex="-1">Basic Example <a class="header-anchor" href="#basic-example-1" aria-label="Permalink to “Basic Example”">​</a></h3><p><strong>Device Subscribes:</strong> <code>123456789/down</code></p><p><strong>Mapping Configuration:</strong></p><ul><li>Original Topic: <code>{device_number}/down</code></li><li>Target Topic: <code>devices/telemetry/control/{device_number}</code></li></ul><p><strong>Result:</strong> Messages published by the platform to <code>devices/telemetry/control/123456789</code> will be automatically forwarded to the topic <code>123456789/down</code> subscribed by the device.</p><h3 id="multi-mapping-scenario" tabindex="-1">Multi-Mapping Scenario <a class="header-anchor" href="#multi-mapping-scenario" aria-label="Permalink to “Multi-Mapping Scenario”">​</a></h3><p>When a device supports multiple command types, <code>data_identifier</code> is used to identify and route them.</p><p><strong>Configuration Example:</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Mapping 1: devices/command/{device_number}/+ → wled/{device_number}/cmd (data_identifier = &quot;wled&quot;)</span></span>
<span class="line"><span>Mapping 2: devices/command/{device_number}/+ → default/{device_number}/cmd (data_identifier = &quot;default&quot;)</span></span></code></pre></div><p><strong>Message Processing Flow:</strong></p><ol><li>Web sends: <code>{&quot;method&quot;: &quot;wled&quot;, &quot;params&quot;: {&quot;delay&quot;: 3}}</code> to <code>devices/command/{device_number}/+</code></li><li>System matches <code>method=&quot;wled&quot;</code> → Hits Mapping 1</li><li>Device receives: <code>{&quot;delay&quot;: 3}</code> at <code>wled/{device_number}/cmd</code> (only <code>params</code> part is forwarded)</li></ol><p><strong>Fallback Rule:</strong></p><ul><li>If none of the configured <code>data_identifier</code> matches, the configuration with empty <code>data_identifier</code> (first one found) is used for forwarding (payload remains unchanged).</li></ul><hr><h2 id="iv-data-processing-function" tabindex="-1">IV. Data Processing Function <a class="header-anchor" href="#iv-data-processing-function" aria-label="Permalink to “IV. Data Processing Function”">​</a></h2><h3 id="definition-2" tabindex="-1">Definition <a class="header-anchor" href="#definition-2" aria-label="Permalink to “Definition”">​</a></h3><p>The data processing function is used to pre-process uplink/downlink messages, including format conversion, field mapping, and data cleaning, to resolve inconsistencies between device message formats and platform standards.</p><h3 id="use-cases" tabindex="-1">Use Cases <a class="header-anchor" href="#use-cases" aria-label="Permalink to “Use Cases”">​</a></h3><p><strong>Scenario 1: Non-JSON Format to JSON Format</strong></p><p>Some devices report data in custom format or CSV format, which needs to be converted to platform standard JSON format.</p><ol><li><strong>Device Report Format</strong> (Custom separator): <code>temp:25.5|hum:60|press:1013.25</code></li><li><strong>Platform Standard Format</strong>: <code>{&quot;temperature&quot;: 25.5, &quot;humidity&quot;: 60, &quot;pressure&quot;: 1013.25}</code></li><li><strong>Solution</strong>: <ul><li>Configure Topic Transformation: Map device topic <code>device/{device_number}/data</code> to platform standard topic <code>devices/telemetry</code></li><li>Configure Data Processing: Use &quot;Uplink Data Pre-processing&quot; to parse custom format and convert to standard JSON structure.</li></ul></li></ol><p><strong>Scenario 2: Nested JSON Structure to Flat JSON Structure</strong></p><p>Some devices report data in nested structure, which needs to be flattened.</p><ol><li><strong>Device Report Format</strong> (Nested):<div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;sensor&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;humidity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1699123456</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><strong>Platform Standard Format</strong> (Flat):<div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;humidity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1699123456</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><strong>Solution</strong>: <ul><li>Configure Topic Transformation: Map device topic to platform standard topic.</li><li>Configure Data Processing: Use &quot;Uplink Data Pre-processing&quot; to flatten the nested structure.</li></ul></li></ol><p><strong>Processing Flow:</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Device Publish → Topic Transformation → Data Processing → Platform Standard Topic</span></span></code></pre></div><hr><h2 id="v-operation-steps" tabindex="-1">V. Operation Steps <a class="header-anchor" href="#v-operation-steps" aria-label="Permalink to “V. Operation Steps”">​</a></h2><h3 id="_5-1-enter-protocol-configuration-page" tabindex="-1">5.1 Enter Protocol Configuration Page <a class="header-anchor" href="#_5-1-enter-protocol-configuration-page" aria-label="Permalink to “5.1 Enter Protocol Configuration Page”">​</a></h3><p><img src="`+s+'" alt="Enter Protocol Config Page"></p><ol><li>Enter Device Template Detail Page.</li><li>Click &quot;Protocol Configuration&quot; tab.</li><li>Select Protocol Type as &quot;MQTT&quot;.</li></ol><h3 id="_5-2-add-uplink-topic-mapping" tabindex="-1">5.2 Add Uplink Topic Mapping <a class="header-anchor" href="#_5-2-add-uplink-topic-mapping" aria-label="Permalink to “5.2 Add Uplink Topic Mapping”">​</a></h3><p><img src="'+n+'" alt="Add Uplink Mapping"></p><ol><li>Click &quot;Add&quot; button.</li><li>Fill mapping info: <ul><li><strong>Mapping Name</strong>: Rule name (Required).</li><li><strong>Data Direction</strong>: Select &quot;Publish: Uplink (Device → Cloud)&quot;.</li><li><strong>Original Topic</strong>: Actual topic published by device, supports <code>+</code> placeholder.</li><li><strong>Target Topic</strong>: Platform standard topic (Dropdown selection).</li><li><strong>Description</strong>: Optional.</li></ul></li><li>Click &quot;Save&quot;.</li></ol><h3 id="_5-3-add-downlink-topic-mapping" tabindex="-1">5.3 Add Downlink Topic Mapping <a class="header-anchor" href="#_5-3-add-downlink-topic-mapping" aria-label="Permalink to “5.3 Add Downlink Topic Mapping”">​</a></h3><p><img src="'+l+'" alt="Add Downlink Mapping"></p><ol><li>Click &quot;Add&quot; button.</li><li>Fill mapping info: <ul><li><strong>Mapping Name</strong>: Rule name (Required).</li><li><strong>Data Direction</strong>: Select &quot;Subscribe: Downlink (Cloud → Device)&quot;.</li><li><strong>Original Topic</strong>: Actual topic subscribed by device, must contain <code>{device_number}</code>.</li><li><strong>Target Topic</strong>: Platform standard topic (Dropdown selection).</li><li><strong>Command Identifier</strong> (Optional): Used for multi-mapping scenarios, matching <code>method</code> field in payload.</li><li><strong>Description</strong>: Optional.</li></ul></li><li>Click &quot;Save&quot;.</li></ol><h3 id="_5-4-edit-and-delete-mapping" tabindex="-1">5.4 Edit and Delete Mapping <a class="header-anchor" href="#_5-4-edit-and-delete-mapping" aria-label="Permalink to “5.4 Edit and Delete Mapping”">​</a></h3><ul><li>Click &quot;Edit&quot; to modify mapping config.</li><li>Click &quot;Delete&quot; to remove mapping rule.</li><li>Click &quot;Save&quot; at bottom of page to apply changes.</li></ul><h3 id="_5-5-configure-data-processing" tabindex="-1">5.5 Configure Data Processing <a class="header-anchor" href="#_5-5-configure-data-processing" aria-label="Permalink to “5.5 Configure Data Processing”">​</a></h3><p><img src="'+r+'" alt="Configure Data Processing"></p><ol><li>In Device Template Detail Page, click &quot;Data Processing&quot; tab.</li><li>Click &quot;Add Data Processing&quot; button.</li><li>Select Processing Type: <ul><li><strong>Uplink Data Pre-processing</strong>: Process telemetry data reported by device.</li><li><strong>Downlink Data Pre-processing</strong>: Process control data sent by platform.</li><li><strong>Attribute Uplink/Downlink Pre-processing</strong>: Process attribute related data.</li><li><strong>Command Downlink Pre-processing</strong>: Process command downlink data.</li><li><strong>Event Uplink Pre-processing</strong>: Process event uplink data.</li></ul></li><li>Configure data processing rules (e.g., field mapping, format conversion).</li><li>Save configuration.</li></ol><p><strong>Processing Order:</strong></p><ul><li>Topic Transformation executes first, forwarding message to standard topic.</li><li>Data Processing executes next, converting message content format.</li></ul><hr><h2 id="vi-notes" tabindex="-1">VI. Notes <a class="header-anchor" href="#vi-notes" aria-label="Permalink to “VI. Notes”">​</a></h2><ol><li><p><strong>Placeholder Rules</strong>:</p><ul><li>Supports <code>+</code> (Single level match), does NOT support <code>#</code> (Multi-level match).</li><li>Downlink original topic MUST contain <code>{device_number}</code> variable.</li></ul></li><li><p><strong>Priority</strong>:</p><ul><li>Mappings match in order of priority (small to large).</li><li>Smaller priority means earlier matching.</li></ul></li><li><p><strong>Multi-mapping Matching</strong>:</p><ul><li>For downlink topic transformation, configurations with non-empty <code>data_identifier</code> are matched first.</li><li>On successful match, payload is simplified to <code>params</code> part.</li><li>On no match, fallback to configuration with empty <code>data_identifier</code> (payload remains unchanged).</li></ul></li><li><p><strong>Cache Mechanism</strong>:</p><ul><li>Mapping config changes automatically clear cache.</li><li>If config doesn&#39;t take effect, wait for cache refresh or restart service.</li></ul></li><li><p><strong>Topic Transformation vs Data Processing</strong>:</p><ul><li>Topic Transformation handles topic mapping.</li><li>Data Processing handles message content conversion.</li><li>Can be used together for complete non-standard device access.</li></ul></li></ol><hr><h2 id="vii-common-questions" tabindex="-1">VII. Common Questions <a class="header-anchor" href="#vii-common-questions" aria-label="Permalink to “VII. Common Questions”">​</a></h2><p><strong>Q: Why is the message published by the device not forwarded?</strong></p><p>A: Check:</p><ul><li>Is Original Topic pattern correctly matching actual device topic?</li><li>Is device associated with the correct device template?</li></ul><p><strong>Q: Why is the payload of downlink message modified?</strong></p><p>A: When <code>data_identifier</code> matches successfully, system automatically simplifies payload to <code>params</code> part. To keep it unchanged, use a fallback configuration with empty <code>data_identifier</code>.</p><p><strong>Q: How to test if topic mapping is working?</strong></p><p>A: Use MQTT client tool:</p><ul><li>Uplink: Simulate device publishing to original topic, observe if platform standard topic receives message.</li><li>Downlink: Publish to standard topic on platform, observe if device subscribed to original topic receives message.</li></ul><p><strong>Q: What is the difference between Topic Transformation and Data Processing?</strong></p><p>A:</p><ul><li><strong>Topic Transformation</strong>: Solves topic name inconsistency, maps device custom topic to platform standard topic.</li><li><strong>Data Processing</strong>: Solves message format inconsistency, converts message content, maps fields, etc.</li><li>Both used together solve complete access requirements for non-standard devices.</li></ul>',81)])])}const b=e(c,[["render",d]]);export{k as __pageData,b as default};
