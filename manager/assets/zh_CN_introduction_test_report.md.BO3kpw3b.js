import{_ as t,c as i,o as a,ah as r}from"./chunks/framework.BDBjiFeZ.js";const b=JSON.parse('{"title":"性能测试报告","description":"","frontmatter":{"sidebar_position":4},"headers":[],"relativePath":"zh_CN/introduction/test_report.md","filePath":"zh_CN/introduction/test_report.md"}'),e={name:"zh_CN/introduction/test_report.md"};function d(n,l,h,s,o,P){return a(),i("div",null,[...l[0]||(l[0]=[r('<h1 id="性能测试报告" tabindex="-1">性能测试报告 <a class="header-anchor" href="#性能测试报告" aria-label="Permalink to “性能测试报告”">​</a></h1><h2 id="thingspanel在raspberry-pi上的全面性能分析报告" tabindex="-1">ThingsPanel在Raspberry Pi上的全面性能分析报告 <a class="header-anchor" href="#thingspanel在raspberry-pi上的全面性能分析报告" aria-label="Permalink to “ThingsPanel在Raspberry Pi上的全面性能分析报告”">​</a></h2><h3 id="测试结论" tabindex="-1">测试结论 <a class="header-anchor" href="#测试结论" aria-label="Permalink to “测试结论”">​</a></h3><p><strong>ThingsPanel能够在2GB内存的树莓派上稳定运行，适合中小规模IoT应用场景</strong>。测试表明系统能够处理每秒约700个数据点的持续写入，足以稳定支持5个设备的100毫秒数据上报，或者<strong>20000个温湿度传感器1分钟频率数据上报</strong>。<strong>主要性能瓶颈是存储I/O性能而非CPU或内存</strong>，特别是在使用标准Class 10 TF卡时。通过优化存储介质（如使用A2级SD卡或外接SSD），系统性能还有10-30倍提升空间。整体而言，树莓派是部署ThingsPanel的经济有效选择，为边缘计算IoT应用提供了可行方案。</p><h3 id="测试方法" tabindex="-1">测试方法 <a class="header-anchor" href="#测试方法" aria-label="Permalink to “测试方法”">​</a></h3><p>本测试采用了多维度资源监控与实际负载测试相结合的方法，全面评估ThingsPanel在树莓派上的性能表现：</p><ol><li><p><strong>系统资源监控</strong>：</p><ul><li>使用自定义脚本<code>monitor_thingspanel.sh</code>实时监控CPU、内存和各组件资源使用</li><li>使用<code>pg_io_monitor.sh</code>专门监控磁盘I/O性能，重点关注数据库分区</li><li>采样间隔1秒，记录各组件资源占用情况</li></ul></li><li><p><strong>负载测试</strong>：</p><ul><li>模拟10个IoT设备并发连接，使用MQTT协议向系统发送数据</li><li>测试数据发送速率约989点/秒，持续200个循环</li><li>通过数据库查询验证数据写入成功率和性能</li></ul></li><li><p><strong>性能分析</strong>：</p><ul><li>对比空闲状态和负载状态下的资源使用差异</li><li>识别系统瓶颈点及其影响程度</li><li>分析各组件（PostgreSQL、Redis、GMQTT等）的资源占用特征</li></ul></li></ol><h3 id="测试环境" tabindex="-1">测试环境 <a class="header-anchor" href="#测试环境" aria-label="Permalink to “测试环境”">​</a></h3><ul><li><p><strong>硬件平台</strong>：</p><ul><li>Raspberry Pi 4</li><li>CPU: 4核心ARM处理器 (aarch64架构)</li><li>内存: 1849MB (约2GB)</li><li>存储: Class 10 TF卡，根分区使用率约94%</li></ul></li><li><p><strong>软件环境</strong>：</p><ul><li>操作系统: Raspbian GNU/Linux 11 (bullseye)</li><li>ThingsPanel组件版本: <ul><li>PostgreSQL/TimescaleDB (Docker容器)</li><li>Redis (Docker容器)</li><li>GMQTT (PM2管理)</li><li>Backend API (PM2管理)</li><li>Nginx (系统服务)</li></ul></li></ul></li><li><p><strong>测试工具</strong>：</p><ul><li>自定义资源监控脚本</li><li>MQTT性能测试客户端 (Go语言实现)</li><li>数据库监控查询脚本</li></ul></li></ul><h3 id="资源使用总结" tabindex="-1">资源使用总结 <a class="header-anchor" href="#资源使用总结" aria-label="Permalink to “资源使用总结”">​</a></h3><h4 id="空闲状态-无数据写入时" tabindex="-1">空闲状态 (无数据写入时) <a class="header-anchor" href="#空闲状态-无数据写入时" aria-label="Permalink to “空闲状态 (无数据写入时)”">​</a></h4><table tabindex="0"><thead><tr><th>指标</th><th>使用率</th><th>实际使用量</th></tr></thead><tbody><tr><td>总CPU使用率</td><td>4.2% - 7.4%</td><td>单核最高约7.4%</td></tr><tr><td>总内存使用率</td><td>约35.2%</td><td>约651MB</td></tr><tr><td>磁盘写入</td><td>0 - 0.07MB/秒</td><td>几乎无写入</td></tr><tr><td>ThingsPanel总CPU</td><td>约2.2%</td><td>单核约2.2%</td></tr><tr><td>ThingsPanel总内存</td><td>约21.2%</td><td>约436MB</td></tr></tbody></table><h4 id="负载状态-有大量数据写入时" tabindex="-1">负载状态 (有大量数据写入时) <a class="header-anchor" href="#负载状态-有大量数据写入时" aria-label="Permalink to “负载状态 (有大量数据写入时)”">​</a></h4><table tabindex="0"><thead><tr><th>指标</th><th>使用率</th><th>实际使用量</th></tr></thead><tbody><tr><td>总CPU使用率</td><td>92.3% - 94.1%</td><td>单核满负载</td></tr><tr><td>总内存使用率</td><td>36.4% - 36.9%</td><td>约682MB</td></tr><tr><td>磁盘写入(mmcblk0p2)</td><td>2.3 - 7.1MB/秒</td><td>峰值达7.1MB/秒</td></tr><tr><td>ThingsPanel总CPU</td><td>82.3% - 113.2%</td><td>超过单核100%</td></tr><tr><td>ThingsPanel总内存</td><td>28.0% - 30.9%</td><td>566MB - 621MB</td></tr></tbody></table><h3 id="各组件资源占用分析" tabindex="-1">各组件资源占用分析 <a class="header-anchor" href="#各组件资源占用分析" aria-label="Permalink to “各组件资源占用分析”">​</a></h3><h4 id="postgresql数据库" tabindex="-1">PostgreSQL数据库 <a class="header-anchor" href="#postgresql数据库" aria-label="Permalink to “PostgreSQL数据库”">​</a></h4><ul><li><strong>空闲时</strong> - CPU: ~0%, 内存: 13.2% (267.3MB), 磁盘写入: 几乎为0</li><li><strong>负载时</strong> - CPU: 80.1% - 111.0%, 内存: 19.9% - 22.8% (396MB - 451MB), 磁盘写入: 2.3 - 7.1MB/秒</li><li><strong>特点</strong>: <ul><li>是CPU、内存和磁盘I/O的主要消耗源</li><li>负载时CPU利用率可达单核满载以上</li><li>数据写入会产生大量磁盘I/O，是系统性能瓶颈</li></ul></li></ul><h4 id="redis" tabindex="-1">Redis <a class="header-anchor" href="#redis" aria-label="Permalink to “Redis”">​</a></h4><ul><li><strong>空闲/负载时</strong> - CPU: 稳定在约1.6%, 内存: 0.4% (18.7MB), 磁盘I/O影响极小</li><li><strong>特点</strong>: 资源占用稳定，不因负载增加而显著变化</li></ul><h4 id="gmqtt-mqtt服务器" tabindex="-1">GMQTT (MQTT服务器) <a class="header-anchor" href="#gmqtt-mqtt服务器" aria-label="Permalink to “GMQTT (MQTT服务器)”">​</a></h4><ul><li><strong>空闲/负载时</strong> - CPU: ~0%, 内存: 0.1% (2.5MB), 磁盘I/O几乎无影响</li><li><strong>特点</strong>: 资源占用极低，即使在MQTT消息频繁传输时也保持稳定</li></ul><h4 id="backend-后端api服务" tabindex="-1">Backend (后端API服务) <a class="header-anchor" href="#backend-后端api服务" aria-label="Permalink to “Backend (后端API服务)”">​</a></h4><ul><li><strong>空闲/负载时</strong> - CPU: ~0%, 内存: 0.1% (2.7MB), 磁盘I/O影响极小</li><li><strong>特点</strong>: 资源占用极低，处理能力良好，主要工作是数据传递</li></ul><h4 id="nginx-web服务器" tabindex="-1">Nginx (Web服务器) <a class="header-anchor" href="#nginx-web服务器" aria-label="Permalink to “Nginx (Web服务器)”">​</a></h4><ul><li><strong>空闲/负载时</strong> - CPU: ~0%, 内存: 0.9% (19.0MB), 磁盘I/O几乎无影响</li><li><strong>特点</strong>: 资源占用稳定，轻量级</li></ul><h4 id="nodejs-pm2-进程管理" tabindex="-1">NodeJS/PM2 (进程管理) <a class="header-anchor" href="#nodejs-pm2-进程管理" aria-label="Permalink to “NodeJS/PM2 (进程管理)”">​</a></h4><ul><li><strong>空闲/负载时</strong> - CPU: 约0.6%, 内存: 6.5% - 6.6% (126MB - 127MB), 磁盘I/O几乎无影响</li><li><strong>特点</strong>: 内存占用中等，CPU占用低</li></ul><h3 id="磁盘i-o性能分析" tabindex="-1">磁盘I/O性能分析 <a class="header-anchor" href="#磁盘i-o性能分析" aria-label="Permalink to “磁盘I/O性能分析”">​</a></h3><p>从磁盘I/O监控数据可以看出以下几点重要信息：</p><ol><li><p><strong>I/O负载与CPU负载强相关</strong>:</p><ul><li>在CPU使用率高峰期(90%+)，分区写入速度稳定在2.3-3.0MB/秒</li><li>在某些峰值时刻，写入速度可达7.1MB/秒</li></ul></li><li><p><strong>存储性能表现</strong>:</p><ul><li>Class 10 TF卡的随机写入性能为系统瓶颈之一</li><li>写入速度在峰值负载下达到了7.1MB/秒，接近Class 10卡随机写入的性能上限</li><li>根分区(mmcblk0p2)使用率已达94%，这可能对写入性能有负面影响</li></ul></li><li><p><strong>特定设备与分区I/O差异</strong>:</p><ul><li>整个设备(mmcblk0)的I/O监控数据与分区(mmcblk0p2)数据存在差异</li><li>必须监控具体分区而非整个设备，才能准确捕获数据库的I/O活动</li></ul></li><li><p><strong>数据库I/O特性</strong>:</p><ul><li>PostgreSQL写入模式呈现为突发性，写入速率在负载期间相对稳定</li><li>写入操作几乎完全由PostgreSQL数据库生成，其他组件几乎不产生磁盘写入</li></ul></li></ol><h3 id="负载测试分析" tabindex="-1">负载测试分析 <a class="header-anchor" href="#负载测试分析" aria-label="Permalink to “负载测试分析”">​</a></h3><p>根据测试日志中的数据，系统在执行性能测试时表现如下：</p><ol><li><p><strong>数据写入能力</strong>:</p><ul><li>系统能够处理约989点/秒的数据写入速率</li><li>平均数据库写入率达到70.7% - 96.3%</li><li>在测试高峰期能够处理约710点/秒的数据库写入速率</li></ul></li><li><p><strong>系统响应</strong>:</p><ul><li>面对高频率数据写入，CPU使用率迅速上升至90%以上</li><li>PostgreSQL数据库成为主要的资源消耗点(CPU和磁盘I/O)</li><li>内存使用率保持相对稳定，仅增加约1.7%</li><li>磁盘写入在数据库活动期间显著增加，与CPU使用率高度相关</li></ul></li><li><p><strong>资源恢复</strong>:</p><ul><li>当数据写入减少时，系统资源使用快速下降</li><li>CPU使用率从92.3%降至25%</li><li>PostgreSQL的CPU使用率从80.1%降至22.6%</li><li>磁盘写入速率迅速下降，趋近于零</li></ul></li></ol><h3 id="关键性能瓶颈识别" tabindex="-1">关键性能瓶颈识别 <a class="header-anchor" href="#关键性能瓶颈识别" aria-label="Permalink to “关键性能瓶颈识别”">​</a></h3><p>基于CPU、内存和磁盘I/O的综合监控数据，可以明确识别ThingsPanel在树莓派上的主要性能瓶颈：</p><ol><li><p><strong>主要瓶颈 - 存储I/O性能</strong>:</p><ul><li>Class 10 TF卡的随机写入速度在处理数据库写入时接近极限</li><li>实测峰值写入速度达7.1MB/秒，接近理论上限</li><li>主要影响系统在高数据吞吐量情况下的稳定性</li></ul></li><li><p><strong>次要瓶颈 - CPU处理能力</strong>:</p><ul><li>PostgreSQL在高负载下CPU使用率超过100%，即超过单核心处理能力</li><li>数据库写入和查询处理是CPU密集型工作</li><li>多核心的利用有助于提升整体性能</li></ul></li><li><p><strong>非瓶颈 - 内存容量</strong>:</p><ul><li>即使在负载下，系统内存使用率仅增加约1.7%</li><li>2GB内存对ThingsPanel来说有足够余量</li><li>内存不是当前配置下的限制因素</li></ul></li></ol><h3 id="结论与建议" tabindex="-1">结论与建议 <a class="header-anchor" href="#结论与建议" aria-label="Permalink to “结论与建议”">​</a></h3><h4 id="总体评估" tabindex="-1">总体评估 <a class="header-anchor" href="#总体评估" aria-label="Permalink to “总体评估”">​</a></h4><p>ThingsPanel在Raspberry Pi (2GB)上表现良好，能够满足中小规模IoT应用需求:</p><ol><li><strong>可行性</strong>: 即使在2GB RAM的Raspberry Pi上，ThingsPanel也能稳定运行</li><li><strong>性能</strong>: 可持续处理约600-700点/秒的数据写入，足够支持10设备同时高频率数据上报</li><li><strong>资源使用效率</strong>: 空闲时仅占用约21.2%的系统内存和极少的CPU</li><li><strong>扩展性</strong>: 系统在负载下保持稳定，内存使用率增加有限</li></ol><h4 id="优化建议" tabindex="-1">优化建议 <a class="header-anchor" href="#优化建议" aria-label="Permalink to “优化建议”">​</a></h4><p><strong>存储优化</strong> (首要优先级):</p><ul><li>使用高性能SD卡(A2级别)或外接SSD通过USB 3.0接口</li><li>清理根分区，保持至少15-20%的可用空间</li><li>考虑将PostgreSQL数据目录移至单独的高速存储设备</li></ul><p><strong>SD卡与SSD在ThingsPanel上的性能对比</strong></p><table tabindex="0"><thead><tr><th>性能指标</th><th>Class 10 SD卡</th><th>SSD (USB 3.0)</th><th>提升倍数</th></tr></thead><tbody><tr><td><strong>随机写入速度</strong></td><td>2-7 MB/秒</td><td><strong>80-300 MB/秒</strong></td><td><strong>10-30倍</strong></td></tr><tr><td>数据点处理能力</td><td>~700点/秒</td><td>3,500-10,000点/秒</td><td>5-15倍</td></tr><tr><td>数据库查询响应</td><td>较慢</td><td>显著更快</td><td>5-15倍</td></tr><tr><td>高负载时CPU使用率</td><td>90-110%</td><td>30-50%</td><td>CPU减负60-70%</td></tr><tr><td>系统稳定性</td><td>容易成为瓶颈</td><td>大幅提升</td><td>质的改善</td></tr></tbody></table><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to “总结”">​</a></h3><p>ThingsPanel在ARM设备尤其是Raspberry Pi上是完全可行的，能够有效支持中小规模IoT应用场景。主要性能瓶颈在于存储I/O性能和数据库处理能力，而非内存限制。即使在2GB内存的设备上，ThingsPanel仍能保持较好的性能表现，这使其成为低成本IoT边缘计算的良好选择。</p><p>通过适当的存储优化和数据库参数调整，性能还有提升空间。对于规模较大的部署，建议使用4GB内存版本的Raspberry Pi，并配备高性能存储设备。</p><h2 id="云服务器测试报告" tabindex="-1">云服务器测试报告 <a class="header-anchor" href="#云服务器测试报告" aria-label="Permalink to “云服务器测试报告”">​</a></h2><h3 id="核心结论" tabindex="-1">核心结论 <a class="header-anchor" href="#核心结论" aria-label="Permalink to “核心结论”">​</a></h3><p>基于本次测试结果，ThingsPanel新架构在1万台设备并发接入的场景下表现出色：</p><ul><li>单集群支持25000/秒的数据写入，CPU峰值利用率维持在82%以下</li><li>在高并发下系统各项指标稳定，数据处理无延迟积压</li><li>基于当前硬件配置，预计可支持40万设备同时接入（按每分钟单设备4个数据点计算）</li></ul><h3 id="_1-测试背景与目的" tabindex="-1">1. 测试背景与目的 <a class="header-anchor" href="#_1-测试背景与目的" aria-label="Permalink to “1. 测试背景与目的”">​</a></h3><p>为验证新架构下系统的并发处理能力，搭建了三节点集群环境进行压力测试。本次测试重点关注：</p><ul><li>系统在高并发环境下的数据处理能力与稳定性</li><li>集群架构下的资源利用效率</li><li>系统扩展潜力评估</li></ul><h3 id="_2-测试环境" tabindex="-1">2. 测试环境 <a class="header-anchor" href="#_2-测试环境" aria-label="Permalink to “2. 测试环境”">​</a></h3><h4 id="服务器配置" tabindex="-1">服务器配置 <a class="header-anchor" href="#服务器配置" aria-label="Permalink to “服务器配置”">​</a></h4><table tabindex="0"><thead><tr><th>机型</th><th>CPU</th><th>内存</th><th>硬盘</th><th>说明</th></tr></thead><tbody><tr><td>云服务器1</td><td>Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz 4核</td><td>8GB</td><td>ESSD云盘 PL0 40GiB (2280 IOPS)</td><td>Cassandra数据库、VerneMQ、数据库和broker的插件应用</td></tr><tr><td>云服务器2</td><td>Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz 4核</td><td>8GB</td><td>ESSD云盘 PL0 40GiB (2280 IOPS)</td><td>Cassandra数据库、VerneMQ、数据库和broker的插件应用</td></tr><tr><td>云服务器3</td><td>Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz 4核</td><td>8GB</td><td>ESSD云盘 PL0 40GiB (2280 IOPS)</td><td>应用平台、TimescaleDB、负载均衡器、测试脚本等</td></tr></tbody></table><h4 id="测试参数设置" tabindex="-1">测试参数设置 <a class="header-anchor" href="#测试参数设置" aria-label="Permalink to “测试参数设置”">​</a></h4><ul><li>设备数量：分别以5000台和10000台设备进行测试</li><li>数据上报频率：每台设备每6.4秒推送16个数据点</li><li>测试持续时间：持续运行24小时以验证系统稳定性</li></ul><h3 id="_3-测试结果" tabindex="-1">3. 测试结果 <a class="header-anchor" href="#_3-测试结果" aria-label="Permalink to “3. 测试结果”">​</a></h3><h4 id="性能指标数据" tabindex="-1">性能指标数据 <a class="header-anchor" href="#性能指标数据" aria-label="Permalink to “性能指标数据”">​</a></h4><table tabindex="0"><thead><tr><th>设备数量</th><th>写入速度</th><th>CPU使用率（%）</th><th>内存使用率（%）</th><th>内网带宽</th><th>云盘读写BPS</th></tr></thead><tbody><tr><td>5000台</td><td>12000/s</td><td>36 / 37 / 40</td><td>35 / 37 / 17</td><td>25M</td><td>38M</td></tr><tr><td>10000台</td><td>25000/s</td><td>72 / 73 / 82</td><td>45 / 48 / 17</td><td>48M</td><td>76M</td></tr></tbody></table><h4 id="系统稳定性表现" tabindex="-1">系统稳定性表现 <a class="header-anchor" href="#系统稳定性表现" aria-label="Permalink to “系统稳定性表现”">​</a></h4><ul><li>数据处理能力：单集群实现25000/秒的持续稳定写入</li><li>响应时间：Web操作平均响应时间维持在200ms以内</li><li>队列状态：测试期间broker队列数据处理实时，无积压</li><li>查询性能：历史数据查询平均响应时间<code>&lt;500ms</code></li></ul><h3 id="_4-分析与结论" tabindex="-1">4. 分析与结论 <a class="header-anchor" href="#_4-分析与结论" aria-label="Permalink to “4. 分析与结论”">​</a></h3><h4 id="性能分析" tabindex="-1">性能分析 <a class="header-anchor" href="#性能分析" aria-label="Permalink to “性能分析”">​</a></h4><ol><li><p>数据处理能力</p><ul><li>在1万设备并发场景下，系统维持25000/秒的写入速度，CPU使用率峰值82%，说明系统仍有性能余量</li><li>数据写入与查询无延迟，表明系统的数据处理管道设计合理</li></ul></li><li><p>资源利用效率</p><ul><li>CPU利用率随设备数量增加呈线性增长，从5000设备时的40%增至1万设备时的82%</li><li>内存使用率增幅较小（17%→48%），显示内存管理优化效果良好</li><li>磁盘IO从38M增加到76M，未达到ESSD云盘性能上限</li></ul></li><li><p>网络传输效率</p><ul><li>内网带宽占用从25M增长到48M，增长比例与设备数量基本匹配</li><li>网络延迟稳定在个位数毫秒级别，说明集群间通信高效</li></ul></li></ol><h4 id="扩展性评估" tabindex="-1">扩展性评估 <a class="header-anchor" href="#扩展性评估" aria-label="Permalink to “扩展性评估”">​</a></h4><p>基于测试数据，对系统扩展性进行了如下评估：</p><ol><li>单集群容量：按每分钟单设备4个数据点计算，当前配置理论上可支持40万设备接入</li><li>横向扩展：通过增加节点，预计系统可线性扩展至百万级设备规模</li><li>资源瓶颈：当前配置下，CPU使用率是最先达到瓶颈的资源，建议后续扩容优先提升CPU配置</li></ol><h3 id="_5-改进建议" tabindex="-1">5. 改进建议 <a class="header-anchor" href="#_5-改进建议" aria-label="Permalink to “5. 改进建议”">​</a></h3><ol><li><p>硬件优化</p><ul><li>建议升级CPU核心数至8核，以提供更充足的计算资源</li><li>考虑使用更高性能的ESSD云盘，为未来数据量增长预留空间</li></ul></li><li><p>软件优化</p><ul><li>优化数据写入批处理机制，减少CPU消耗</li><li>实现智能负载均衡，提高集群资源利用率</li><li>增强监控告警机制，提前预警潜在瓶颈</li></ul></li></ol><h3 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to “结论”">​</a></h3><p>测试表明，ThingsPanel架构具备优秀的并发处理能力和可扩展性。在中等硬件配置下，单集群可稳定支持万级设备接入，为未来支撑更大规模物联网应用奠定了基础。系统在设备数量倍增的情况下，仍保持线性的资源消耗增长，这验证了架构设计的合理性和效能。后续可通过优化资源配置和软件架构，进一步提升系统性能。</p>',75)])])}const p=t(e,[["render",d]]);export{b as __pageData,p as default};
