import{_ as i,c as t,o as a,ah as n}from"./chunks/framework.BDBjiFeZ.js";const E=JSON.parse('{"title":"直连设备MQTT数据交互规范","description":"","frontmatter":{"sidebar_position":11},"headers":[],"relativePath":"zh_CN/device-connect/mqtt-device-rule.md","filePath":"zh_CN/device-connect/mqtt-device-rule.md"}'),e={name:"zh_CN/device-connect/mqtt-device-rule.md"};function l(h,s,d,k,p,r){return a(),t("div",null,[...s[0]||(s[0]=[n(`<h1 id="直连设备mqtt数据交互规范" tabindex="-1">直连设备MQTT数据交互规范 <a class="header-anchor" href="#直连设备mqtt数据交互规范" aria-label="Permalink to “直连设备MQTT数据交互规范”">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to “概述”">​</a></h2><p>本规范描述直连设备通过MQTT协议连接到ThingsPanel平台的技术要求，定义了设备与平台之间的数据交互格式和通信协议。</p><h2 id="核心概念" tabindex="-1">核心概念 <a class="header-anchor" href="#核心概念" aria-label="Permalink to “核心概念”">​</a></h2><div class="info custom-block"><p class="custom-block-title">四大核心数据类型</p><p>在开始之前，了解四个核心概念对于理解本规范至关重要：</p><ul><li><strong>🔄 遥测（Telemetry）</strong> - 设备实时上报的数据，通常是随时间变化的测量值 <ul><li>例如：温度传感器定期上报的温度读数</li></ul></li><li><strong>📋 属性（Attributes）</strong> - 设备的静态或较少变化的特征信息 <ul><li>例如：设备的IP地址、MAC地址或固件版本</li></ul></li><li><strong>🎯 事件（Events）</strong> - 设备中发生的特定事件或状态变化 <ul><li>例如：检测到运动或设备启动完成</li></ul></li><li><strong>⚡ 命令（Commands）</strong> - 平台发送到设备的控制指令 <ul><li>例如：开关灯或重置设备</li></ul></li></ul></div><h2 id="关键参数说明" tabindex="-1">关键参数说明 <a class="header-anchor" href="#关键参数说明" aria-label="Permalink to “关键参数说明”">​</a></h2><h3 id="📍-message-id-消息标识符" tabindex="-1">📍 message_id（消息标识符） <a class="header-anchor" href="#📍-message-id-消息标识符" aria-label="Permalink to “📍 message_id（消息标识符）”">​</a></h3><ul><li><strong>作用</strong>：消息唯一标识符，确保消息不重复,长度不限</li><li><strong>建议</strong>：使用毫秒时间戳的后七位</li><li><strong>要求</strong>：在短期内保持唯一性</li></ul><h3 id="🏷️-device-number-设备编号" tabindex="-1">🏷️ device_number（设备编号） <a class="header-anchor" href="#🏷️-device-number-设备编号" aria-label="Permalink to “🏷️ device_number（设备编号）”">​</a></h3><ul><li><strong>作用</strong>：设备在系统中的唯一标识</li><li><strong>要求</strong>：全局唯一，不可重复</li></ul><h3 id="🎭-method-方法标识" tabindex="-1">🎭 method（方法标识） <a class="header-anchor" href="#🎭-method-方法标识" aria-label="Permalink to “🎭 method（方法标识）”">​</a></h3><ul><li><strong>定义</strong>：用来标识特定命令或事件类型的字符串</li><li><strong>命令示例</strong>：<code>&quot;SetTemperature&quot;</code>、<code>&quot;TurnOnLight&quot;</code>、<code>&quot;RebootDevice&quot;</code></li><li><strong>事件示例</strong>：<code>&quot;TemperatureExceeded&quot;</code>、<code>&quot;MotionDetected&quot;</code>、<code>&quot;BatteryLow&quot;</code></li></ul><h3 id="⚙️-params-参数对象" tabindex="-1">⚙️ params（参数对象） <a class="header-anchor" href="#⚙️-params-参数对象" aria-label="Permalink to “⚙️ params（参数对象）”">​</a></h3><ul><li><strong>作用</strong>：包含与method相关的详细信息或数据</li><li><strong>命令场景</strong>：提供执行命令所需的具体参数</li><li><strong>事件场景</strong>：包含描述事件的相关数据</li></ul><h2 id="mqtt认证规则" tabindex="-1">MQTT认证规则 <a class="header-anchor" href="#mqtt认证规则" aria-label="Permalink to “MQTT认证规则”">​</a></h2><div class="warning custom-block"><p class="custom-block-title">认证要求</p><h3 id="🔐-唯一性要求" tabindex="-1">🔐 唯一性要求 <a class="header-anchor" href="#🔐-唯一性要求" aria-label="Permalink to “🔐 唯一性要求”">​</a></h3><ul><li><strong>Username + Password</strong> 组合必须全局唯一</li><li><strong>ClientID</strong> 必须全局唯一</li></ul><h3 id="🔄-一致性要求" tabindex="-1">🔄 一致性要求 <a class="header-anchor" href="#🔄-一致性要求" aria-label="Permalink to “🔄 一致性要求”">​</a></h3><ul><li>设备每次连接时必须使用相同的认证信息</li><li>保持 ClientID、Username 和 Password 的一致性</li></ul></div><h2 id="mqtt主题规范" tabindex="-1">MQTT主题规范 <a class="header-anchor" href="#mqtt主题规范" aria-label="Permalink to “MQTT主题规范”">​</a></h2><div class="tip custom-block"><p class="custom-block-title">灵活实现</p><p><strong>重要说明</strong>：设备无需实现所有列出的MQTT主题。应根据设备的具体功能和应用场景，选择性地实现相关主题。开发者应仔细评估设备需求，只实现必要的主题，以优化设备性能和资源利用。</p></div><h3 id="设备上报主题" tabindex="-1">设备上报主题 <a class="header-anchor" href="#设备上报主题" aria-label="Permalink to “设备上报主题”">​</a></h3><table tabindex="0"><thead><tr><th>主题</th><th>说明</th><th>数据类型</th><th>是否必需</th></tr></thead><tbody><tr><td><code>devices/telemetry</code></td><td>上报遥测数据</td><td>遥测</td><td>可选</td></tr><tr><td><code>devices/attributes/{message_id}</code></td><td>上报属性状态</td><td>属性</td><td>可选</td></tr><tr><td><code>devices/event/{message_id}</code></td><td>上报事件信息</td><td>事件</td><td>可选</td></tr><tr><td><code>ota/devices/progress</code></td><td>上报OTA升级进度</td><td>OTA</td><td>可选</td></tr><tr><td><code>devices/command/response/{message_id}</code></td><td>命令执行响应</td><td>响应</td><td>可选</td></tr><tr><td><code>devices/attributes/set/response/{message_id}</code></td><td>属性设置响应</td><td>响应</td><td>可选</td></tr></tbody></table><h3 id="设备订阅主题" tabindex="-1">设备订阅主题 <a class="header-anchor" href="#设备订阅主题" aria-label="Permalink to “设备订阅主题”">​</a></h3><p>:::note 主题说明 <strong>注意：</strong> <code>+</code> 表示 <code>message_id</code> 占位符，<code>{device_number}</code> 为具体设备编号 :::</p><table tabindex="0"><thead><tr><th>主题</th><th>说明</th><th>数据类型</th><th>是否必需</th></tr></thead><tbody><tr><td><code>devices/telemetry/control/{device_number}</code></td><td>接收遥测控制指令</td><td>控制</td><td>可选</td></tr><tr><td><code>devices/attributes/set/{device_number}/+</code></td><td>接收属性设置指令</td><td>属性设置</td><td>可选</td></tr><tr><td><code>devices/attributes/get/{device_number}</code></td><td>接收属性查询请求</td><td>属性查询</td><td>可选</td></tr><tr><td><code>devices/command/{device_number}/+</code></td><td>接收命令执行请求</td><td>命令</td><td>可选</td></tr><tr><td><code>ota/devices/inform/{device_number}</code></td><td>接收OTA升级任务</td><td>OTA</td><td>可选</td></tr><tr><td><code>devices/attributes/response/{device_number}/+</code></td><td>接收属性响应确认</td><td>响应确认</td><td>可选</td></tr><tr><td><code>devices/event/response/{device_number}/+</code></td><td>接收事件响应确认</td><td>响应确认</td><td>可选</td></tr></tbody></table><h2 id="数据交互格式" tabindex="-1">数据交互格式 <a class="header-anchor" href="#数据交互格式" aria-label="Permalink to “数据交互格式”">​</a></h2><h3 id="🔄-遥测数据上报" tabindex="-1">🔄 遥测数据上报 <a class="header-anchor" href="#🔄-遥测数据上报" aria-label="Permalink to “🔄 遥测数据上报”">​</a></h3><p><strong>主题：</strong> <code>devices/telemetry</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">28.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;switch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="📋-属性数据上报" tabindex="-1">📋 属性数据上报 <a class="header-anchor" href="#📋-属性数据上报" aria-label="Permalink to “📋 属性数据上报”">​</a></h3><p><strong>主题：</strong> <code>devices/attributes/{message_id}</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;ip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mac&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxxxxxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;port&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1883</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="🎯-事件数据上报" tabindex="-1">🎯 事件数据上报 <a class="header-anchor" href="#🎯-事件数据上报" aria-label="Permalink to “🎯 事件数据上报”">​</a></h3><p><strong>主题：</strong> <code>devices/event/{message_id}</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;FindAnimal&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;animalType&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cat&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="📦-ota升级进度上报" tabindex="-1">📦 OTA升级进度上报 <a class="header-anchor" href="#📦-ota升级进度上报" aria-label="Permalink to “📦 OTA升级进度上报”">​</a></h3><p><strong>主题：</strong> <code>ota/devices/progress</code></p><p><strong>成功进度：</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;step&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;100&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;desc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;升级进度100%&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MCU&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>失败示例：</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;step&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;desc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;OTA升级失败，请求不到升级包信息。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MCU&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="升级步骤说明" tabindex="-1">升级步骤说明 <a class="header-anchor" href="#升级步骤说明" aria-label="Permalink to “升级步骤说明”">​</a></h4><table tabindex="0"><thead><tr><th>步骤值</th><th>说明</th></tr></thead><tbody><tr><td><code>1-100</code></td><td>升级进度百分比</td></tr><tr><td><code>-1</code></td><td>升级失败</td></tr><tr><td><code>-2</code></td><td>下载失败</td></tr><tr><td><code>-3</code></td><td>校验失败</td></tr><tr><td><code>-4</code></td><td>烧写失败</td></tr></tbody></table><h3 id="⚡-接收控制指令" tabindex="-1">⚡ 接收控制指令 <a class="header-anchor" href="#⚡-接收控制指令" aria-label="Permalink to “⚡ 接收控制指令”">​</a></h3><p><strong>主题：</strong> <code>devices/telemetry/control/{device_number}</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">28.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;light&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;switch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="📋-接收属性设置" tabindex="-1">📋 接收属性设置 <a class="header-anchor" href="#📋-接收属性设置" aria-label="Permalink to “📋 接收属性设置”">​</a></h3><p><strong>主题：</strong> <code>devices/attributes/set/{device_number}/+</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;ip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;mac&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxxxxxxxxx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;port&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1883</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="🔍-接收属性查询请求" tabindex="-1">🔍 接收属性查询请求 <a class="header-anchor" href="#🔍-接收属性查询请求" aria-label="Permalink to “🔍 接收属性查询请求”">​</a></h3><p><strong>主题：</strong> <code>devices/attributes/get/{device_number}</code></p><p><strong>查询所有属性：</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;keys&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>查询指定属性：</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;keys&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;temp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hum&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="⚡-接收命令执行请求" tabindex="-1">⚡ 接收命令执行请求 <a class="header-anchor" href="#⚡-接收命令执行请求" aria-label="Permalink to “⚡ 接收命令执行请求”">​</a></h3><p><strong>主题：</strong> <code>devices/command/{device_number}/+</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ReSet&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;switch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;light&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;close&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="📦-接收ota升级任务" tabindex="-1">📦 接收OTA升级任务 <a class="header-anchor" href="#📦-接收ota升级任务" aria-label="Permalink to “📦 接收OTA升级任务”">​</a></h3><p><strong>主题：</strong> <code>ota/devices/inform/{device_number}</code></p><h4 id="ota任务参数说明" tabindex="-1">OTA任务参数说明 <a class="header-anchor" href="#ota任务参数说明" aria-label="Permalink to “OTA任务参数说明”">​</a></h4><table tabindex="0"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>id</code></td><td>Long</td><td>消息ID号，在当前设备中具有唯一性</td></tr><tr><td><code>code</code></td><td>String</td><td>状态码</td></tr><tr><td><code>version</code></td><td>String</td><td>设备升级包的版本信息</td></tr><tr><td><code>size</code></td><td>Long</td><td>升级包文件大小，单位：字节</td></tr><tr><td><code>url</code></td><td>String</td><td>升级包存储地址</td></tr><tr><td><code>sign</code></td><td>String</td><td>OTA升级包文件的签名</td></tr><tr><td><code>signMethod</code></td><td>String</td><td>签名方法：SHA256、MD5</td></tr><tr><td><code>module</code></td><td>String</td><td>升级包所属的模块名</td></tr><tr><td><code>extData</code></td><td>Object</td><td>升级批次标签列表和自定义信息</td></tr></tbody></table><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">432945</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://dev.thingspane.cn/files/ota/s121jg3245gg.zip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;signMethod&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Md5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;sign&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;a243fgh4b9v&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MCU&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;extData&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;key1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;key2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value2&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="响应格式规范" tabindex="-1">响应格式规范 <a class="header-anchor" href="#响应格式规范" aria-label="Permalink to “响应格式规范”">​</a></h2><h3 id="响应参数说明" tabindex="-1">响应参数说明 <a class="header-anchor" href="#响应参数说明" aria-label="Permalink to “响应参数说明”">​</a></h3><table tabindex="0"><thead><tr><th>参数</th><th>是否必输</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>result</code></td><td>✅</td><td>number</td><td>执行结果：<code>0</code>-成功，<code>1</code>-失败</td></tr><tr><td><code>errcode</code></td><td>❌</td><td>string</td><td>错误码（失败时提供）</td></tr><tr><td><code>message</code></td><td>✅</td><td>string</td><td>响应消息内容</td></tr><tr><td><code>ts</code></td><td>❌</td><td>number</td><td>时间戳（秒）</td></tr><tr><td><code>method</code></td><td>❌</td><td>string</td><td>事件和命令的方法名</td></tr></tbody></table><h3 id="响应格式示例" tabindex="-1">响应格式示例 <a class="header-anchor" href="#响应格式示例" aria-label="Permalink to “响应格式示例”">​</a></h3><p><strong>成功响应：</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;result&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1609143039</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>失败响应：</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;result&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;errcode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INVALID_PARAM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Parameter validation failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1609143039</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ReSet&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>带方法的成功响应：</strong></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;result&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Command executed successfully&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1609143039</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;method&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ReSet&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to “最佳实践”">​</a></h2><div class="tip custom-block"><p class="custom-block-title">开发建议</p><ol><li><strong>消息ID管理</strong> - 建议使用时间戳后7位，确保短期内消息ID不重复</li><li><strong>选择性实现</strong> - 根据设备功能需求选择实现的主题，避免不必要的资源消耗</li><li><strong>认证信息</strong> - 确保每次连接使用相同的认证信息，保持连接稳定性</li><li><strong>错误处理</strong> - 实现完整的错误响应机制，便于问题诊断</li><li><strong>数据验证</strong> - 上报前验证JSON格式的正确性</li><li><strong>连接保持</strong> - 实现MQTT心跳机制保持连接稳定</li><li><strong>重连机制</strong> - 网络异常时自动重连</li><li><strong>OTA升级</strong> - 实现升级进度上报，提升用户体验</li></ol></div><div class="warning custom-block"><p class="custom-block-title">注意事项</p><ul><li>确保设备编号在系统中全局唯一</li><li>遥测数据建议定期上报，避免数据丢失</li><li>命令执行后建议返回响应确认</li><li>属性设置需要验证参数有效性</li><li>OTA升级过程中及时上报进度和状态</li><li>保持认证信息的一致性，避免连接失败</li><li>合理选择订阅主题，减少不必要的网络流量</li></ul></div>`,74)])])}const g=i(e,[["render",l]]);export{E as __pageData,g as default};
