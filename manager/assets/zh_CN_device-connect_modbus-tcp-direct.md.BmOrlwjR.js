import{_ as s,c as a,o as t,ah as l,eM as e,eN as h}from"./chunks/framework.BDBjiFeZ.js";const E=JSON.parse('{"title":"TCP接入","description":"","frontmatter":{"sidebar_position":5},"headers":[],"relativePath":"zh_CN/device-connect/modbus-tcp-direct.md","filePath":"zh_CN/device-connect/modbus-tcp-direct.md"}'),n={name:"zh_CN/device-connect/modbus-tcp-direct.md"};function r(p,i,k,d,o,c){return t(),a("div",null,[...i[0]||(i[0]=[l('<h1 id="tcp接入" tabindex="-1">TCP接入 <a class="header-anchor" href="#tcp接入" aria-label="Permalink to “TCP接入”">​</a></h1><p>TCP协议设备接入有以下两种方式</p><h2 id="第一种-通过规则引擎的方式" tabindex="-1">第一种：通过规则引擎的方式 <a class="header-anchor" href="#第一种-通过规则引擎的方式" aria-label="Permalink to “第一种：通过规则引擎的方式”">​</a></h2><p>ThingsPanel对接自定义TCP设备【通过规则引擎】<br><a href="https://www.bilibili.com/video/BV1Xe411K7Lk/?spm_id_from=333.999.0.0" target="_blank" rel="noreferrer">https://www.bilibili.com/video/BV1Xe411K7Lk/?spm_id_from=333.999.0.0</a></p><h2 id="第二种-使用tcp设备接入服务方式接入" tabindex="-1">第二种：使用TCP设备接入服务方式接入 <a class="header-anchor" href="#第二种-使用tcp设备接入服务方式接入" aria-label="Permalink to “第二种：使用TCP设备接入服务方式接入”">​</a></h2><p><code>TCP设备接入服务</code>是单独运行的服务，通过TCP设备接入服务，设备就可以跟平台交互数据。设备接入服务可以与ThingsPanel在同一台计算机上运行，也可以在另一台可通过网络访问ThingsPanel实例的计算机上运行。</p><h3 id="协议分类" tabindex="-1">协议分类 <a class="header-anchor" href="#协议分类" aria-label="Permalink to “协议分类”">​</a></h3><p>TCP设备接入服务支持两种TCP类型的报文接入：</p><ol><li>自定义TCP协议</li><li>官方TCP协议</li></ol><p>:::note</p><p>两种TCP类型的接入都支持<strong>标准设备</strong>和<strong>网关设备</strong></p><p>:::</p><h3 id="自定义tcp协议" tabindex="-1">自定义TCP协议 <a class="header-anchor" href="#自定义tcp协议" aria-label="Permalink to “自定义TCP协议”">​</a></h3><p>通过透传的方式从TCP设备接入服务发送消息到平台或从设备接入服务接收平台发来的消息。</p><h4 id="对接步骤" tabindex="-1">对接步骤： <a class="header-anchor" href="#对接步骤" aria-label="Permalink to “对接步骤：”">​</a></h4><ol><li><p>在平台创建设备，选择设备或网关，点击编辑参数，选择<code>自定义TCP协议</code>,获取认证令牌AccessToken，查看访问地址。 <img src="'+e+'" alt="编辑参数"></p></li><li><p>点击设备配置，在数据解析栏填写缓冲区大小（默认1KB）。 <img src="'+h+'" alt="设备配置"></p></li><li><p>根据自定义消息编写数据处理脚本（设备列表-&gt;编辑参数-&gt;数据处理脚本）。</p><ul><li>上行解析脚本 需要将自定义的tcp消息格式处理成平台可使用的格式，例如（平台可使用的格式）： <ul><li>设备：</li></ul><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">36.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;humidity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>网关： &quot;3c20c6206&quot;为子设备地址（设备列表-&gt;编辑参数（子设备））。</li></ul><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;3c20c6206&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">36.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;humidity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span></code></pre></div></li><li>下行解析脚本 下行脚本与上行脚本相反，需要将平台格式转换为自定义的tcp消息格式</li></ul></li><li><p>设备与设备接入服务建立连接后，首先需要推送认证信息（AccessToken）,通过认证后就可以上报数据到平台或接收平台的数据。</p></li></ol><h3 id="官方tcp协议" tabindex="-1">官方TCP协议 <a class="header-anchor" href="#官方tcp协议" aria-label="Permalink to “官方TCP协议”">​</a></h3><p>官方TCP协议是设备接入服务定义的规范，按照此规范便可以对接到平台。</p><h4 id="规范" tabindex="-1">规范 <a class="header-anchor" href="#规范" aria-label="Permalink to “规范”">​</a></h4><p>在客户端连接到服务器之前，必须在 thingsPanel 中创建 IoT 设备并获取访问令牌。 然后客户端发送以下结构：</p><table tabindex="0"><thead><tr><th>IDENT</th><th>IDENT</th><th>TYPE</th><th>CMD</th><th>LENGTH</th><th>PAYLOAD</th></tr></thead><tbody><tr><td>&#39;T&#39;</td><td>&#39;P&#39;</td><td>1 byte</td><td>1 byte</td><td>4 byte</td><td>Variable</td></tr></tbody></table><ul><li>TYPE：<br> 0x0：数据包<br> 0x1：心跳数据包</li><li>CMD：<br> 0x0：设备身份验证<br> 0x1：发布属性<br> 0x2：推送事件</li><li>LENGTH：PAYLOAD的长度</li><li>PAYLOAD：有效载荷数据 如果 CMD 0x0，则PAYLOAD是访问令牌<br> 如果 CMD 0x1，则PAYLOAD是属性<br> 如果 CMD 0x2，则PAYLOAD是事件</li></ul><h4 id="对接步骤-1" tabindex="-1">对接步骤 <a class="header-anchor" href="#对接步骤-1" aria-label="Permalink to “对接步骤”">​</a></h4><ol><li>在平台创建设备，选择设备或网关，点击编辑参数，选择<code>官网TCP协议</code>,获取认证令牌AccessToken，查看访问地址。</li><li>（可选，如果PAYLOAD已是平台可使用格式就不用再编写处理脚本）根据PAYLOAD编写数据处理脚本（设备列表-&gt;编辑参数-&gt;数据处理脚本）。 <ul><li>上行解析脚本 需要将PAYLOAD消息格式处理成平台可使用的格式，例如（平台可使用的格式）： <ul><li>设备：</li></ul><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">36.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;humidity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>网关： &quot;3c20c6206&quot;为子设备地址（设备列表-&gt;编辑参数（子设备））。</li></ul><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;3c20c6206&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">36.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;humidity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">52</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span></code></pre></div></li><li>下行解析脚本 下行脚本与上行脚本相反，需要将平台格式转换为PAYLOAD消息格式</li></ul></li><li>设备与设备接入服务建立连接后，首先需要推送认证信息（AccessToken）,发送CMD(0X0)的数据包，认证成功便可推送属性或事件。</li></ol><h3 id="tcp设备接入服务github库" tabindex="-1">TCP设备接入服务github库 <a class="header-anchor" href="#tcp设备接入服务github库" aria-label="Permalink to “TCP设备接入服务github库”">​</a></h3><p><a href="https://github.com/ThingsPanel/tcp-protocol-plugin" target="_blank" rel="noreferrer">https://github.com/ThingsPanel/tcp-protocol-plugin</a></p>',26)])])}const u=s(n,[["render",r]]);export{E as __pageData,u as default};
