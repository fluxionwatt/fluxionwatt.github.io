import{_ as i,c as a,o as l,ah as n}from"./chunks/framework.BDBjiFeZ.js";const g=JSON.parse('{"title":"优化指南","description":"","frontmatter":{"sidebar_position":7},"headers":[],"relativePath":"zh_CN/installation/optimization.md","filePath":"zh_CN/installation/optimization.md"}'),e={name:"zh_CN/installation/optimization.md"};function t(h,s,p,r,k,d){return l(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="优化指南" tabindex="-1">优化指南 <a class="header-anchor" href="#优化指南" aria-label="Permalink to “优化指南”">​</a></h1><h2 id="_1-系统性能优化" tabindex="-1">1. 系统性能优化 <a class="header-anchor" href="#_1-系统性能优化" aria-label="Permalink to “1. 系统性能优化”">​</a></h2><h3 id="_1-1-应用服务优化" tabindex="-1">1.1 应用服务优化 <a class="header-anchor" href="#_1-1-应用服务优化" aria-label="Permalink to “1.1 应用服务优化”">​</a></h3><ul><li><p><strong>后端服务优化</strong></p><ul><li>日志级别调整：生产环境建议设置为 WARNING 或 ERROR 级别</li><li>并发连接数优化：调整系统文件描述符限制</li><li>API 服务缓存策略优化</li><li>数据批量处理机制优化</li></ul></li><li><p><strong>消息代理优化</strong></p><ul><li>VerneMQ 并发连接数配置</li><li>消息队列大小调整</li><li>消息持久化策略优化</li><li>会话清理周期配置</li></ul></li></ul><h3 id="_1-2-系统资源优化" tabindex="-1">1.2 系统资源优化 <a class="header-anchor" href="#_1-2-系统资源优化" aria-label="Permalink to “1.2 系统资源优化”">​</a></h3><ul><li><p><strong>操作系统层面</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 调整系统最大文件描述符数量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fs.file-max=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 调整系统最大连接数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> net.core.somaxconn=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">65535</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># TCP 连接优化</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> net.ipv4.tcp_max_syn_backlog=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8192</span></span></code></pre></div></li><li><p><strong>容器资源配置</strong></p><ul><li>合理分配容器 CPU 限制</li><li>设置适当的内存限制</li><li>配置合适的 Docker 存储驱动</li></ul></li></ul><h2 id="_2-数据库优化" tabindex="-1">2. 数据库优化 <a class="header-anchor" href="#_2-数据库优化" aria-label="Permalink to “2. 数据库优化”">​</a></h2><h3 id="_2-1-tdengine-优化" tabindex="-1">2.1 TDengine 优化 <a class="header-anchor" href="#_2-1-tdengine-优化" aria-label="Permalink to “2.1 TDengine 优化”">​</a></h3><ul><li><p><strong>系统配置</strong></p><div class="language-properties"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 调整写入缓存大小</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 2048</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 优化查询缓存</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">queryBufferSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 2048</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 压缩级别设置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 2</span></span></code></pre></div></li><li><p><strong>数据存储优化</strong></p><ul><li>合理设置数据保留策略</li><li>优化数据分区策略</li><li>配置数据压缩比例</li></ul></li></ul><h3 id="_2-2-postgresql-timescaledb-优化" tabindex="-1">2.2 PostgreSQL/TimescaleDB 优化 <a class="header-anchor" href="#_2-2-postgresql-timescaledb-优化" aria-label="Permalink to “2.2 PostgreSQL/TimescaleDB 优化”">​</a></h3><ul><li><p><strong>内存配置</strong></p><div class="language-properties"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 共享缓冲区</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">shared_buffers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = RAM * 0.25</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 工作内存</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">work_mem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = RAM * 0.025</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 维护工作内存</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">maintenance_work_mem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = RAM * 0.05</span></span></code></pre></div></li><li><p><strong>连接配置</strong></p><div class="language-properties"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 最大连接数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">max_connections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 200</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 连接池配置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">max_prepared_transactions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 100</span></span></code></pre></div></li></ul><h3 id="_2-3-redis-优化" tabindex="-1">2.3 Redis 优化 <a class="header-anchor" href="#_2-3-redis-优化" aria-label="Permalink to “2.3 Redis 优化”">​</a></h3><ul><li><p><strong>内存管理</strong></p><div class="language-properties"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 最大内存限制</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">maxmemory 2gb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 内存策略</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">maxmemory-policy allkeys-lru</span></span></code></pre></div></li><li><p><strong>持久化配置</strong></p><div class="language-properties"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># RDB 配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">save 900 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">save 300 10</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">save 60 10000</span></span></code></pre></div></li></ul><h2 id="_3-网络优化" tabindex="-1">3. 网络优化 <a class="header-anchor" href="#_3-网络优化" aria-label="Permalink to “3. 网络优化”">​</a></h2><h3 id="_3-1-负载均衡优化" tabindex="-1">3.1 负载均衡优化 <a class="header-anchor" href="#_3-1-负载均衡优化" aria-label="Permalink to “3.1 负载均衡优化”">​</a></h3><ul><li><p><strong>Nginx 配置</strong></p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 工作进程数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_processes </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">auto;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 每个工作进程的连接数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_connections </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">65535</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开启 gzip 压缩</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">gzip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">gzip_min_length </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div></li></ul><h3 id="_3-2-网络传输优化" tabindex="-1">3.2 网络传输优化 <a class="header-anchor" href="#_3-2-网络传输优化" aria-label="Permalink to “3.2 网络传输优化”">​</a></h3><ul><li>启用 Keep-Alive 连接</li><li>配置合适的超时时间</li><li>优化 TCP 参数</li></ul><h2 id="_4-监控与调优工具" tabindex="-1">4. 监控与调优工具 <a class="header-anchor" href="#_4-监控与调优工具" aria-label="Permalink to “4. 监控与调优工具”">​</a></h2><h3 id="_4-1-系统监控" tabindex="-1">4.1 系统监控 <a class="header-anchor" href="#_4-1-系统监控" aria-label="Permalink to “4.1 系统监控”">​</a></h3><ul><li>使用 Prometheus + Grafana 监控系统指标</li><li>配置关键指标告警</li><li>定期检查系统性能报告</li></ul><h3 id="_4-2-性能分析工具" tabindex="-1">4.2 性能分析工具 <a class="header-anchor" href="#_4-2-性能分析工具" aria-label="Permalink to “4.2 性能分析工具”">​</a></h3><ul><li>CPU 分析：top, htop</li><li>内存分析：free, vmstat</li><li>磁盘 I/O：iostat</li><li>网络性能：netstat, iftop</li></ul><h2 id="_5-优化建议流程" tabindex="-1">5. 优化建议流程 <a class="header-anchor" href="#_5-优化建议流程" aria-label="Permalink to “5. 优化建议流程”">​</a></h2><ol><li><p><strong>性能基准测试</strong></p><ul><li>记录当前系统性能指标</li><li>确定性能瓶颈</li></ul></li><li><p><strong>制定优化计划</strong></p><ul><li>根据监控确定优先级</li><li>评估优化成本和收益</li></ul></li><li><p><strong>分步实施优化</strong></p><ul><li>每次只调整一个参数</li><li>记录调整效果</li></ul></li><li><p><strong>效果验证</strong></p><ul><li>对比优化前后的性能</li><li>持续监控系统稳定性</li></ul></li></ol><h2 id="_6-注意事项" tabindex="-1">6. 注意事项 <a class="header-anchor" href="#_6-注意事项" aria-label="Permalink to “6. 注意事项”">​</a></h2><ul><li>优化参数需要根据实际硬件配置调整</li><li>重要参数调整前需要备份配置</li><li>生产环境的调整需要在测试环境验证</li><li>保持系统监控，及时发现问题</li></ul><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>以上配置参数仅供参考，实际部署时需要根据具体的硬件配置、业务场景和压力测试结果来调整。</p></div>`,28)])])}const c=i(e,[["render",t]]);export{g as __pageData,c as default};
