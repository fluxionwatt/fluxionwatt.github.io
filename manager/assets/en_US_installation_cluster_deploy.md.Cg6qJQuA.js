import{_ as s,c as i,o as e,ah as l}from"./chunks/framework.BDBjiFeZ.js";const E=JSON.parse('{"title":"Cluster Deployment","description":"","frontmatter":{"sidebar_position":6},"headers":[],"relativePath":"en_US/installation/cluster_deploy.md","filePath":"en_US/installation/cluster_deploy.md"}'),n={name:"en_US/installation/cluster_deploy.md"};function t(r,a,p,o,h,c){return e(),i("div",null,[...a[0]||(a[0]=[l(`<h1 id="cluster-deployment" tabindex="-1">Cluster Deployment <a class="header-anchor" href="#cluster-deployment" aria-label="Permalink to “Cluster Deployment”">​</a></h1><h2 id="cluster-deployment-architecture" tabindex="-1">Cluster Deployment Architecture <a class="header-anchor" href="#cluster-deployment-architecture" aria-label="Permalink to “Cluster Deployment Architecture”">​</a></h2><div class="language-mermaid"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart TB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    %% External Connections</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    devices[&quot;IoT Devices&lt;br&gt;(MQTT/HTTP/CoAP)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    users[&quot;Users/Apps&lt;br&gt;(Web/API Access)&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    %% Load Balancer Layer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph LB[&quot;Load Balancing Layer&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        lb[&quot;LB Cluster&lt;br&gt;(Nginx/HAProxy)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    %% Message Broker Layer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph MB[&quot;Message Broker Layer&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mqtt1[&quot;MQTT Broker Node 1&lt;br&gt;(VerneMQ)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mqtt2[&quot;MQTT Broker Node 2&lt;br&gt;(VerneMQ)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mqtt3[&quot;MQTT Broker Node N&lt;br&gt;(VerneMQ)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        webhook1[&quot;Webhook Service 1&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        webhook2[&quot;Webhook Service 2&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        webhook3[&quot;Webhook Service N&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    %% Application Layer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph APP[&quot;Application Layer&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        subgraph TP1[&quot;App Node 1&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            api1[&quot;Backend API&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tdengine1[&quot;TSDB Service&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        subgraph TP2[&quot;App Node 2&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            api2[&quot;Backend API&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tdengine2[&quot;TSDB Service&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        subgraph TP3[&quot;App Node N&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            api3[&quot;Backend API&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tdengine3[&quot;TSDB Service&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    %% Cache Layer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph CACHE[&quot;Cache Layer&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        redis1[&quot;Redis Master&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        redis2[&quot;Redis Slave 1&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        redis3[&quot;Redis Slave N&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    %% Database Layer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph DB[&quot;Database Layer&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        td[&quot;TSDB Cluster&lt;br&gt;(TDengine)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pg[&quot;Meta DB Cluster&lt;br&gt;(PostgreSQL/TimescaleDB)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    %% Connections</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    devices --&gt; lb</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    users --&gt; lb</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lb --&gt; mqtt1 &amp; mqtt2 &amp; mqtt3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lb --&gt; api1 &amp; api2 &amp; api3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mqtt1 &lt;--&gt; mqtt2 &lt;--&gt; mqtt3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mqtt1 --- webhook1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mqtt2 --- webhook2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mqtt3 --- webhook3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mqtt1 --&gt; tdengine1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mqtt2 --&gt; tdengine2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mqtt3 --&gt; tdengine3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api1 --- tdengine1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api2 --- tdengine2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api3 --- tdengine3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tdengine1 &amp; tdengine2 &amp; tdengine3 --&gt; td</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api1 &amp; api2 &amp; api3 --&gt; redis1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    redis1 --&gt; redis2 &amp; redis3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api1 &amp; api2 &amp; api3 --&gt; pg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api1 &amp; api2 &amp; api3 --&gt; td</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    %% Styles</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    classDef default fill:#f9f9f9,stroke:#333,stroke-width:1px</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    classDef external fill:#f0f0f0,stroke:#666,stroke-width:1px</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    classDef layer fill:#e6f3ff,stroke:#333,stroke-width:2px</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    class devices,users external</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    class LB,MB,APP,CACHE,DB layer</span></span></code></pre></div><h2 id="_1-overall-architecture" tabindex="-1">1. Overall Architecture <a class="header-anchor" href="#_1-overall-architecture" aria-label="Permalink to “1. Overall Architecture”">​</a></h2><p>ThingsPanel adopts a layered architecture design, divided from top to bottom into Load Balancing Layer, Message Broker Layer, Application Layer, Cache Layer, and Database Layer. This layered architecture features high availability, scalability, and maintainability.</p><h2 id="_2-detailed-layer-description" tabindex="-1">2. Detailed Layer Description <a class="header-anchor" href="#_2-detailed-layer-description" aria-label="Permalink to “2. Detailed Layer Description”">​</a></h2><h3 id="_2-1-access-layer" tabindex="-1">2.1 Access Layer <a class="header-anchor" href="#_2-1-access-layer" aria-label="Permalink to “2.1 Access Layer”">​</a></h3><ul><li><p><strong>Device Onboarding</strong></p><ul><li>Supports multiple protocols: MQTT, HTTP, CoAP</li><li>Supports massive concurrent device connections</li><li>Supports device authentication and security mechanisms</li></ul></li><li><p><strong>User Access</strong></p><ul><li>Supports Web interface access</li><li>Provides standard REST API interfaces</li><li>Supports various client application integrations</li></ul></li></ul><h3 id="_2-2-load-balancing-layer" tabindex="-1">2.2 Load Balancing Layer <a class="header-anchor" href="#_2-2-load-balancing-layer" aria-label="Permalink to “2.2 Load Balancing Layer”">​</a></h3><ul><li><strong>Components</strong>: Nginx/HAProxy Cluster</li><li><strong>Functions</strong>: <ul><li>Implements load balancing for connections</li><li>Guarantees high availability</li><li>Supports horizontal scaling</li><li>Traffic control and security protection</li></ul></li></ul><h3 id="_2-3-message-broker-layer" tabindex="-1">2.3 Message Broker Layer <a class="header-anchor" href="#_2-3-message-broker-layer" aria-label="Permalink to “2.3 Message Broker Layer”">​</a></h3><ul><li><p><strong>MQTT Broker Nodes (VerneMQ)</strong></p><ul><li>Supports cluster deployment</li><li>Data synchronization between nodes</li><li>Real-time forwarding of device messages</li><li>Supports QoS guarantees</li></ul></li><li><p><strong>Webhook Service</strong></p><ul><li>Tightly integrated with MQTT Broker</li><li>Provides message pre-processing capabilities</li><li>Supports custom message processing logic</li></ul></li></ul><h3 id="_2-4-application-layer" tabindex="-1">2.4 Application Layer <a class="header-anchor" href="#_2-4-application-layer" aria-label="Permalink to “2.4 Application Layer”">​</a></h3><ul><li><p><strong>Backend API Service</strong></p><ul><li>Device Management</li><li>User Permission Management</li><li>Alert Management</li><li>Data Visualization</li></ul></li><li><p><strong>TSDB Service</strong></p><ul><li>Efficient storage of device data</li><li>Data cleaning and transformation</li><li>Data analysis and processing</li><li>Historical data management</li></ul></li></ul><h3 id="_2-5-cache-layer" tabindex="-1">2.5 Cache Layer <a class="header-anchor" href="#_2-5-cache-layer" aria-label="Permalink to “2.5 Cache Layer”">​</a></h3><ul><li><strong>Redis Cluster</strong><ul><li>Uses Master-Slave architecture</li><li>Provides high-speed data caching</li><li>Supports session management</li><li>Improves system response speed</li></ul></li></ul><h3 id="_2-6-database-layer" tabindex="-1">2.6 Database Layer <a class="header-anchor" href="#_2-6-database-layer" aria-label="Permalink to “2.6 Database Layer”">​</a></h3><ul><li><p><strong>Time-Series Database (TDengine)</strong></p><ul><li>Optimized for IoT data characteristics</li><li>High-performance data storage and query</li><li>Supports data compression</li><li>Provides data retention policies</li></ul></li><li><p><strong>Meta Database (PostgreSQL/TimescaleDB)</strong></p><ul><li>Stores business metadata</li><li>Device configuration information</li><li>User and permission data</li><li>Supports complex business queries</li></ul></li></ul><h2 id="_3-system-characteristics" tabindex="-1">3. System Characteristics <a class="header-anchor" href="#_3-system-characteristics" aria-label="Permalink to “3. System Characteristics”">​</a></h2><h3 id="_3-1-high-availability" tabindex="-1">3.1 High Availability <a class="header-anchor" href="#_3-1-high-availability" aria-label="Permalink to “3.1 High Availability”">​</a></h3><ul><li>All layers support cluster deployment</li><li>Designed with no single point of failure</li><li>Service automatic fault tolerance and recovery</li><li>Multi-replica data storage</li></ul><h3 id="_3-2-scalability" tabindex="-1">3.2 Scalability <a class="header-anchor" href="#_3-2-scalability" aria-label="Permalink to “3.2 Scalability”">​</a></h3><ul><li>Supports horizontal scaling</li><li>Layers can be scaled independently</li><li>Flexible node addition/removal</li><li>Dynamic load balancing</li></ul><h3 id="_3-3-security" tabindex="-1">3.3 Security <a class="header-anchor" href="#_3-3-security" aria-label="Permalink to “3.3 Security”">​</a></h3><ul><li>Device onboarding security authentication</li><li>Data transmission encryption</li><li>User access permission control</li><li>Multi-layer security protection</li></ul><h3 id="_3-4-maintainability" tabindex="-1">3.4 Maintainability <a class="header-anchor" href="#_3-4-maintainability" aria-label="Permalink to “3.4 Maintainability”">​</a></h3><ul><li>Decoupled component design</li><li>Easy issue localization</li><li>Supports online upgrades</li><li>Comprehensive monitoring and alerting</li></ul><h2 id="_4-deployment-recommendations" tabindex="-1">4. Deployment Recommendations <a class="header-anchor" href="#_4-deployment-recommendations" aria-label="Permalink to “4. Deployment Recommendations”">​</a></h2><h3 id="_4-1-small-scale-deployment-10k-devices" tabindex="-1">4.1 Small Scale Deployment (<code>&lt;10k</code> Devices) <a class="header-anchor" href="#_4-1-small-scale-deployment-10k-devices" aria-label="Permalink to “4.1 Small Scale Deployment (&lt;10k Devices)”">​</a></h3><ul><li>Minimal component deployment</li><li>Single node deployment is sufficient</li><li>Recommended Config: <ul><li>2 Core 4GB+ Server</li><li>100GB+ Storage</li></ul></li></ul><h3 id="_4-2-medium-scale-deployment-10k-100k-devices" tabindex="-1">4.2 Medium Scale Deployment (10k-100k Devices) <a class="header-anchor" href="#_4-2-medium-scale-deployment-10k-100k-devices" aria-label="Permalink to “4.2 Medium Scale Deployment (10k-100k Devices)”">​</a></h3><ul><li>Recommended Dual-Node Cluster deployment</li><li>Redundant backup for key components</li><li>Recommended Config: <ul><li>4 Core 8GB+ Server</li><li>500GB+ Storage</li></ul></li></ul><h3 id="_4-3-large-scale-deployment-100k-devices" tabindex="-1">4.3 Large Scale Deployment (<code>&gt;100k</code> Devices) <a class="header-anchor" href="#_4-3-large-scale-deployment-100k-devices" aria-label="Permalink to “4.3 Large Scale Deployment (&gt;100k Devices)”">​</a></h3><ul><li>Full Component Cluster deployment</li><li>Cross-AZ Disaster Recovery</li><li>Recommended Config: <ul><li>8 Core 16GB+ Server</li><li>1TB+ Storage</li><li>Scale nodes based on actual demand</li></ul></li></ul><h2 id="_5-scalability-recommendations" tabindex="-1">5. Scalability Recommendations <a class="header-anchor" href="#_5-scalability-recommendations" aria-label="Permalink to “5. Scalability Recommendations”">​</a></h2><ul><li>Reserve over 50% performance margin</li><li>Plan expansion in stages</li><li>Monitor data storage capacity</li><li>Perform regular performance assessments</li></ul>`,36)])])}const k=s(n,[["render",t]]);export{E as __pageData,k as default};
