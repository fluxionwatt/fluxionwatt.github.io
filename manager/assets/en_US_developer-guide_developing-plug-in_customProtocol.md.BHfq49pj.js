import{_ as e,c as s,o as a,ah as t,an as n}from"./chunks/framework.BDBjiFeZ.js";const k=JSON.parse('{"title":"Device Connectivity Service Dev Guide","description":"","frontmatter":{"sidebar_position":4},"headers":[],"relativePath":"en_US/developer-guide/developing-plug-in/customProtocol.md","filePath":"en_US/developer-guide/developing-plug-in/customProtocol.md"}'),l={name:"en_US/developer-guide/developing-plug-in/customProtocol.md"};function r(o,i,c,p,h,d){return a(),s("div",null,[...i[0]||(i[0]=[t('<h1 id="device-connectivity-service-dev-guide" tabindex="-1">Device Connectivity Service Dev Guide <a class="header-anchor" href="#device-connectivity-service-dev-guide" aria-label="Permalink to ‚ÄúDevice Connectivity Service Dev Guide‚Äù">‚Äã</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to ‚ÄúOverview‚Äù">‚Äã</a></h2><h3 id="background-issues" tabindex="-1">Background &amp; Issues <a class="header-anchor" href="#background-issues" aria-label="Permalink to ‚ÄúBackground &amp; Issues‚Äù">‚Äã</a></h3><p>In the IoT field, communication protocols are extremely diverse and complex. Common protocols include MQTT, TCP, HTTP, SOAP, Modbus, OPC-UA, Bacnet, KNX, LwM2M, SNMP, etc., along with countless other protocols and various gateway or third-party services.</p><div class="warning custom-block"><p class="custom-block-title">Status Quo &amp; Challenges</p><ul><li><strong>Complexity</strong>: These protocols and services differ in communication patterns and message specifications, leading to huge complexity in system integration.</li><li><strong>Consequences</strong>: This complexity makes the system bloated and inefficient, and also difficult to extend and maintain, resulting in high maintenance costs.</li></ul></div><h3 id="service-definition" tabindex="-1">Service Definition <a class="header-anchor" href="#service-definition" aria-label="Permalink to ‚ÄúService Definition‚Äù">‚Äã</a></h3><p>The Device Connectivity Service is a multifunctional middleware component that acts as a bridge between devices and the system, connecting devices to the ThingsPanel platform and enabling interaction between devices and the platform.</p><h3 id="service-categories" tabindex="-1">Service Categories <a class="header-anchor" href="#service-categories" aria-label="Permalink to ‚ÄúService Categories‚Äù">‚Äã</a></h3><div class="info custom-block"><p class="custom-block-title">Two Core Categories</p><ol><li><strong>Device Connectivity Service</strong>: Supports various IoT protocols (e.g., MODBUS, MQTT), enabling ThingsPanel to communicate <strong>directly</strong> with devices using these protocols.</li><li><strong>Third-party Connectivity Service</strong>: Connects ThingsPanel with various third-party IoT platforms, communicating with devices <strong>indirectly</strong> to achieve data interoperability and device management.</li></ol></div><h3 id="key-features" tabindex="-1">Key Features <a class="header-anchor" href="#key-features" aria-label="Permalink to ‚ÄúKey Features‚Äù">‚Äã</a></h3><ul><li>üîó Provides unified interface specifications, simplifying access for devices and third-party platforms.</li><li>üåê Supports multiple protocols and services, enhancing ThingsPanel&#39;s compatibility and extensibility.</li><li>‚öôÔ∏è Enables flexible configuration and credential management, facilitating quick access to different protocols and third-party platforms.</li><li>üìä Real-time data synchronization and device status monitoring.</li><li>üîß Modular design, easy to extend to support new protocols and third-party platforms.</li></ul><h3 id="interaction-structure-diagram" tabindex="-1">Interaction Structure Diagram <a class="header-anchor" href="#interaction-structure-diagram" aria-label="Permalink to ‚ÄúInteraction Structure Diagram‚Äù">‚Äã</a></h3><p><img src="'+n+`" alt=""></p><h3 id="architecture-diagram" tabindex="-1">Architecture Diagram <a class="header-anchor" href="#architecture-diagram" aria-label="Permalink to ‚ÄúArchitecture Diagram‚Äù">‚Äã</a></h3><div class="language-mermaid"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph &quot;Device Layer&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        D1[Direct Device]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        D2[Gateway Device]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        D3[Sub-device]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TP[Third-party Platform]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph &quot;Service Layer&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        CP[Device Connectivity Service]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SP[Third-party Connectivity Service]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph &quot;Platform Layer&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        MQTT[MQTT Broker]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        API[Platform API]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TP_CORE[ThingsPanel Core]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    D1 --&gt; CP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    D2 --&gt; CP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    D3 --&gt; CP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TP --&gt; SP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CP --&gt; MQTT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SP --&gt; MQTT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    MQTT --&gt; TP_CORE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CP &lt;--&gt; API</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SP &lt;--&gt; API</span></span></code></pre></div><h2 id="device-connectivity-service-interaction-flow" tabindex="-1">Device Connectivity Service Interaction Flow <a class="header-anchor" href="#device-connectivity-service-interaction-flow" aria-label="Permalink to ‚ÄúDevice Connectivity Service Interaction Flow‚Äù">‚Äã</a></h2><div class="language-mermaid"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sequenceDiagram</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant User</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant OurPlatform as IoT Platform</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant Plugin as Connectivity Service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    participant ThirdParty as Third-party Platform</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Plugin-&gt;&gt;OurPlatform: Register Service (or Admin register)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    User-&gt;&gt;OurPlatform: Create device template for this service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    User-&gt;&gt;OurPlatform: Click page to select service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    User-&gt;&gt;OurPlatform: Input service credentials (auth info)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    OurPlatform-&gt;&gt;Plugin: Get device list based on credentials</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Plugin-&gt;&gt;ThirdParty: Get device list</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ThirdParty-&gt;&gt;Plugin: Return device list</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Plugin-&gt;&gt;OurPlatform: Show device list</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    User-&gt;&gt;OurPlatform: Select devices, bind template</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    OurPlatform-&gt;&gt;OurPlatform: Store credentials, create devices</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    OurPlatform-&gt;&gt;Plugin: Notify new service access (with credentials)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Plugin-&gt;&gt;ThirdParty: Establish connection with 3rd-party platform</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    loop Device Data Interaction</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ThirdParty-&gt;&gt;Plugin: 3rd-party device data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Plugin-&gt;&gt;OurPlatform: Report device data (MQTT)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        OurPlatform-&gt;&gt;Plugin: Issue control (MQTT)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Plugin-&gt;&gt;ThirdParty: Forward to 3rd-party</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span></code></pre></div><h2 id="development-guide" tabindex="-1">Development Guide <a class="header-anchor" href="#development-guide" aria-label="Permalink to ‚ÄúDevelopment Guide‚Äù">‚Äã</a></h2><h3 id="preparation" tabindex="-1">Preparation <a class="header-anchor" href="#preparation" aria-label="Permalink to ‚ÄúPreparation‚Äù">‚Äã</a></h3><div class="language-mermaid"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mindmap</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  root((Device Connectivity Service Dev))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    1. Preparation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Dev Environment Setup</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Get Test Account</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Download Template Code</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    2. Protocol Understanding</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Data Format</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Communication Flow</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Command Structure</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    3. Code Implementation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Auth Logic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Data Parsing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Data Forwarding</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Command Processing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    4. Form Development</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Device Credential Form</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Service Credential Form</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Configuration Form</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    5. Test &amp; Deploy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Local Debugging</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Env Deployment</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Functional Testing</span></span></code></pre></div><h3 id="development-steps" tabindex="-1">Development Steps <a class="header-anchor" href="#development-steps" aria-label="Permalink to ‚ÄúDevelopment Steps‚Äù">‚Äã</a></h3><h4 id="_1-download-service-template" tabindex="-1">1. Download Service Template <a class="header-anchor" href="#_1-download-service-template" aria-label="Permalink to ‚Äú1. Download Service Template‚Äù">‚Äã</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://gitee.com/ThingsPanel/protocol-plugin-template.git</span></span></code></pre></div><h4 id="_2-understand-core-concepts" tabindex="-1">2. Understand Core Concepts <a class="header-anchor" href="#_2-understand-core-concepts" aria-label="Permalink to ‚Äú2. Understand Core Concepts‚Äù">‚Äã</a></h4><div class="info custom-block"><p class="custom-block-title">Four Core Data Types</p><p>Understanding ThingsPanel&#39;s four data models is crucial for plugin development:</p><ul><li><strong>üîÑ Telemetry</strong> - Real-time data reported by devices, usually measurements changing over time.</li><li><strong>üìã Attributes</strong> - Static or less frequently changing characteristics of devices.</li><li><strong>üéØ Events</strong> - Specific events or state changes occurring in devices.</li><li><strong>‚ö° Commands</strong> - Control instructions sent from the platform to devices.</li></ul></div><h4 id="_3-modify-template-code" tabindex="-1">3. Modify Template Code <a class="header-anchor" href="#_3-modify-template-code" aria-label="Permalink to ‚Äú3. Modify Template Code‚Äù">‚Äã</a></h4><ul><li>Read <code>README-DEV.md</code> in the template source.</li><li>Update SDK to latest version:<div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> github.com/ThingsPanel/tp-protocol-sdk-go@latest</span></span></code></pre></div></li><li>Modify credential form <code>from_voucher.json</code> based on protocol docs.</li><li>Determine if configuration form is needed.</li><li>Modify interface implementation in <code>http_service/service.go</code>.</li></ul><h4 id="_4-register-device-connectivity-service" tabindex="-1">4. Register Device Connectivity Service <a class="header-anchor" href="#_4-register-device-connectivity-service" aria-label="Permalink to ‚Äú4. Register Device Connectivity Service‚Äù">‚Äã</a></h4><p>Register the service on the platform using a Super Admin account:</p><ul><li><strong>App Management</strong> ‚Üí <strong>Connectivity Service Management</strong> ‚Üí <strong>Add New Service</strong></li></ul><h4 id="_5-write-core-logic" tabindex="-1">5. Write Core Logic <a class="header-anchor" href="#_5-write-core-logic" aria-label="Permalink to ‚Äú5. Write Core Logic‚Äù">‚Äã</a></h4><ul><li>Handle upstream/downstream device messages.</li><li>Use AI tools to assist in generating protocol parsing code.</li><li>Interact with the platform via MQTT client.</li></ul><h4 id="_6-integration-testing" tabindex="-1">6. Integration Testing <a class="header-anchor" href="#_6-integration-testing" aria-label="Permalink to ‚Äú6. Integration Testing‚Äù">‚Äã</a></h4><ul><li>Create device template and select protocol.</li><li>Create device and bind template.</li><li>Fill in device credential info.</li><li>Connect device to the service and test.</li></ul><h2 id="technical-specifications" tabindex="-1">Technical Specifications <a class="header-anchor" href="#technical-specifications" aria-label="Permalink to ‚ÄúTechnical Specifications‚Äù">‚Äã</a></h2><p>Reference API Docs: <a href="https://docs.thingspanel.io/en/developer-guide/api-reference/index.html" target="_blank" rel="noreferrer">ThingsPanel API Docs</a></p><p>Table of Contents:</p><ul><li>‚ú® Device Connectivity Service - Platform Provided</li><li>‚ú® Device Connectivity Service - Service Provided</li></ul><h2 id="data-interaction-specifications" tabindex="-1">Data Interaction Specifications <a class="header-anchor" href="#data-interaction-specifications" aria-label="Permalink to ‚ÄúData Interaction Specifications‚Äù">‚Äã</a></h2><h3 id="service-pushes-data-to-platform" tabindex="-1">Service Pushes Data to Platform <a class="header-anchor" href="#service-pushes-data-to-platform" aria-label="Permalink to ‚ÄúService Pushes Data to Platform‚Äù">‚Äã</a></h3><h4 id="direct-device-sub-device-gateway-device-messages" tabindex="-1">Direct Device / Sub-device / Gateway Device Messages <a class="header-anchor" href="#direct-device-sub-device-gateway-device-messages" aria-label="Permalink to ‚ÄúDirect Device / Sub-device / Gateway Device Messages‚Äù">‚Äã</a></h4><ul><li><strong>MQTT User</strong>: plugin</li><li><strong>Publish Topic</strong>: <code>device/telemetry</code></li><li><strong>MESSAGE Format</strong>:<div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;device_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;device_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;values&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span></code></pre></div></li></ul><h4 id="online-offline-notification" tabindex="-1">Online/Offline Notification <a class="header-anchor" href="#online-offline-notification" aria-label="Permalink to ‚ÄúOnline/Offline Notification‚Äù">‚Äã</a></h4><ul><li><strong>Publish Topic</strong>: <code>devices/status/{device_id}</code></li><li><strong>Payload</strong>: 0 - Device Offline 1 - Device Online</li></ul><h3 id="platform-pushes-data-to-service" tabindex="-1">Platform Pushes Data to Service <a class="header-anchor" href="#platform-pushes-data-to-service" aria-label="Permalink to ‚ÄúPlatform Pushes Data to Service‚Äù">‚Äã</a></h3><h4 id="subscribe-topic-spec" tabindex="-1">Subscribe Topic Spec <a class="header-anchor" href="#subscribe-topic-spec" aria-label="Permalink to ‚ÄúSubscribe Topic Spec‚Äù">‚Äã</a></h4><p>The service needs to subscribe to topics with a prefix:</p><ul><li><strong>Subscribe Topic</strong>: <code>plugin/{service_identifier}/#</code></li><li><strong>Explanation</strong>: <code>plugin/{service_identifier}/</code> is the prefix filled in during registration. The <code>#</code> part follows the <a href="./../../device-connectivity/mqtt-device-rule.html">MQTT Device Onboarding Rules</a>.</li></ul><p>:::note Topic Mapping The service&#39;s subscription topic adds a prefix compared to the platform downstream spec. Also <code>device_number</code> should be changed to <code>device_id</code>. :::</p><h2 id="service-registration" tabindex="-1">Service Registration <a class="header-anchor" href="#service-registration" aria-label="Permalink to ‚ÄúService Registration‚Äù">‚Äã</a></h2><h3 id="registration-parameters" tabindex="-1">Registration Parameters <a class="header-anchor" href="#registration-parameters" aria-label="Permalink to ‚ÄúRegistration Parameters‚Äù">‚Äã</a></h3><table tabindex="0"><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>Service Name</td><td>Displayed in protocol dropdown when creating device template</td></tr><tr><td>Service Identifier</td><td>Unique ID in the system, alphanumeric</td></tr><tr><td>Category</td><td>Select access protocol</td></tr><tr><td>HTTP Service Address</td><td>Address for platform backend to access service API, e.g., 127.0.0.1:8151</td></tr><tr><td>Service Sub Prefix</td><td>Format like <code>service/{name}/</code></td></tr><tr><td>Device Onboarding Address</td><td>Displayed under device credential management, prompt for user device connection address</td></tr></tbody></table><h3 id="registration-method" tabindex="-1">Registration Method <a class="header-anchor" href="#registration-method" aria-label="Permalink to ‚ÄúRegistration Method‚Äù">‚Äã</a></h3><h4 id="platform-registration" tabindex="-1">Platform Registration <a class="header-anchor" href="#platform-registration" aria-label="Permalink to ‚ÄúPlatform Registration‚Äù">‚Äã</a></h4><ol><li>Login as Super Admin.</li><li>Go to <strong>Integration Management</strong> ‚Üí <strong>Connectivity Service Management</strong>.</li><li>Click <strong>Add New Service</strong>.</li><li>Fill in configuration info.</li></ol><h2 id="resources" tabindex="-1">Resources <a class="header-anchor" href="#resources" aria-label="Permalink to ‚ÄúResources‚Äù">‚Äã</a></h2><div class="tip custom-block"><p class="custom-block-title">Dev Resources</p><ul><li><a href="./../../device-connectivity/mqtt-gateway-rule.html">MQTT Gateway Access Rules</a></li><li><a href="./../../device-connectivity/mqtt-device-rule.html">MQTT Direct Device Onboarding Rules</a></li><li><a href="https://github.com/ThingsPanel/modbus-protocol-plugin" target="_blank" rel="noreferrer">Modbus Service Example</a></li><li><a href="https://gitee.com/ThingsPanel/protocol-plugin-pressure-transmitter" target="_blank" rel="noreferrer">GB26875.3-2011 Service Example</a></li></ul></div><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to ‚ÄúBest Practices‚Äù">‚Äã</a></h2><div class="warning custom-block"><p class="custom-block-title">Dev Notes</p><ol><li><strong>Message ID Management</strong>: Recommend using last 7 digits of timestamp to ensure uniqueness in short term.</li><li><strong>Device Uniqueness</strong>: Ensure device ID is globally unique in the system.</li><li><strong>Error Handling</strong>: Implement complete error response mechanism for diagnosis.</li><li><strong>Performance</strong>: Recommend parsing data within the service to avoid script conversion.</li><li><strong>Form Validation</strong>: Validate JSON format before reporting.</li><li><strong>Device State Management</strong>: Implement state management including online/offline.</li></ol></div>`,59)])])}const E=e(l,[["render",r]]);export{k as __pageData,E as default};
