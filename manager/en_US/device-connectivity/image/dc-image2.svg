<svg viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg">
  <!-- 背景 -->
  <rect width="900" height="600" fill="#f7f9fc" />
  
  <!-- 标题 -->
  <text x="450" y="40" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#333">设备模板与产品的一型一密认证流程图</text>

  <!-- 顶部对象框 -->
  <rect x="70" y="80" width="160" height="50" fill="#5ecea6" rx="4" ry="4" />
  <text x="150" y="110" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" fill="#333">设备</text>
  
  <rect x="370" y="80" width="160" height="50" fill="#5ecea6" rx="4" ry="4" />
  <text x="450" y="110" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" fill="#333">平台认证服务</text>
  
  <rect x="670" y="80" width="160" height="50" fill="#5ecea6" rx="4" ry="4" />
  <text x="750" y="110" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" fill="#333">平台连接服务</text>

  <!-- 纵向生命线 -->
  <line x1="150" y1="130" x2="150" y2="550" stroke="#5ecea6" stroke-width="2" />
  <line x1="450" y1="130" x2="450" y2="550" stroke="#5ecea6" stroke-width="2" />
  <line x1="750" y1="130" x2="750" y2="550" stroke="#5ecea6" stroke-width="2" />

  <!-- 设备预置信息 -->
  <rect x="70" y="150" width="160" height="50" fill="#fff6c4" rx="4" ry="4" stroke="#e6c000" stroke-width="1" />
  <text x="150" y="180" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">设备预置模板密钥</text>
  
  <!-- 自环箭头：获取设备唯一标识 -->
  <path d="M 150,220 C 200,220 200,260 150,260" stroke="#333" stroke-width="2" fill="none" />
  <polygon points="155,260 150,270 145,260" fill="#333" />
  <text x="225" y="245" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">获取设备唯一标识</text>

  <!-- 判断是否有ProductKey -->
  <path d="M 150,290 C 200,290 200,330 150,330" stroke="#333" stroke-width="2" fill="none" />
  <polygon points="155,330 150,340 145,330" fill="#333" />
  <text x="245" y="315" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">判断是否预置ProductKey</text>

  <!-- 发送认证请求 - 仅模板密钥 -->
  <line x1="150" y1="370" x2="450" y2="370" stroke="#333" stroke-width="2" />
  <polygon points="440,365 450,370 440,375" fill="#333" />
  <text x="300" y="360" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">请求认证(模板密钥+设备标识)</text>

  <!-- 自环箭头：平台验证设备 -->
  <path d="M 450,390 C 500,390 500,430 450,430" stroke="#333" stroke-width="2" fill="none" />
  <polygon points="455,430 450,440 445,430" fill="#333" />
  <text x="540" y="415" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">验证设备请求并创建设备</text>

  <!-- 返回设备凭证 -->
  <line x1="450" y1="470" x2="150" y2="470" stroke="#333" stroke-width="2" />
  <polygon points="160,465 150,470 160,475" fill="#333" />
  <text x="300" y="460" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">返回唯一凭证(DeviceVoucher)</text>

  <!-- 建立连接 -->
  <line x1="150" y1="520" x2="750" y2="520" stroke="#333" stroke-width="2" />
  <polygon points="740,515 750,520 740,525" fill="#333" />
  <text x="450" y="510" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">建立安全连接</text>

  <!-- 底部对象框 -->
  <rect x="70" y="550" width="160" height="50" fill="#5ecea6" rx="4" ry="4" />
  <text x="150" y="580" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" fill="#333">设备</text>
  
  <rect x="370" y="550" width="160" height="50" fill="#5ecea6" rx="4" ry="4" />
  <text x="450" y="580" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" fill="#333">平台认证服务</text>
  
  <rect x="670" y="550" width="160" height="50" fill="#5ecea6" rx="4" ry="4" />
  <text x="750" y="580" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" fill="#333">平台连接服务</text>

  <!-- 可选路径文本说明 -->
  <text x="300" y="200" font-family="Arial, sans-serif" font-size="14" fill="#666" font-style="italic">仅模板密钥认证流程</text>
</svg>